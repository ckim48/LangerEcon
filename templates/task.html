{% extends "header.html" %}
{% block task %}
<head>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f9f9f9;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: auto;
            padding: 20px;
        }

        .task-card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background-color: #fff;
        }

        .card-header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            text-align: center;
        }

        #startSection h2 {
            font-size: 1.85rem;
            color: #555;
        }

        #startSection ul {
            list-style: none;
            padding: 0;
            font-size: 1.2rem;
            color: #777;
        }

        #startSection ul li {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        #startSection ul li:before {
            content: "â€¢";
            color: #ff6b6b;
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-right: 10px;
        }

        .btn-task {
            background: linear-gradient(45deg, #ff6b6b, #f06595);
            border: none;
            color: #fff;
            font-size: 1rem;
            padding: 12px 24px;
            border-radius: 30px;
            transition: background 0.3s ease;
        }

        .btn-task:hover {
            background: linear-gradient(45deg, #f06595, #ff6b6b);
        }
#shopSection {
    position: relative;
}

#finishTaskBtnContainer {
    position: absolute;
    bottom: 20px;
    right: 20px;
}
.shop-card {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
    height: 220px;
    padding: 20px;
    position: relative;
}

.btn-icon {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: transparent;
    border: none;
    color: #007bff;
    font-size: 1.5rem;
    padding: 5px;
    cursor: pointer;
}

.btn-icon i {
    margin-right: 0;
}

.btn-icon:hover {
    background-color: transparent;
    color: #0056b3;
}
.shop-img {
    width: 100%;
    height: 80px;
    margin-top: 35px;
    object-fit: contain;
}
        .shop-card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 1.0rem;
            font-weight: 600;
            color: #333;
        }

 .btn-enter {
     width: 100px;
    background-color: #007bff;
    color: #fff;
    border-radius: 30px;
    padding: 10px 20px;
    margin-top: auto;
    transition: background 0.3s ease;
}

        .btn-enter:hover {
            background-color: #0056b3;
        }

        .shop-items-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .shop-item-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 15px;
            width: 220px;
            text-align: center;
        }

        .shop-item-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .btn-buy {
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .btn-buy:hover {
            background-color: #218838;
        }

        #otherChoicesChart {
            width: 100%;
            height: 400px;
        }
        .btn-success{
            font-size: 19px;
            padding:10px 20px;
        }
#shopSection {
    background-image: url('../static/img/shoppingmall.jpg'); /* Replace with a stylized game mall background */
    background-size: cover;
    background-position: center;
    padding: 50px 30px;
    border-radius: 15px;
    position: relative;
    color: #fff;
}

#shopSection::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5); /* Slightly dark overlay for contrast */
    z-index: 1;
    border-radius: 15px;
}

.shop-card {
    position: relative;
    z-index: 2;
    border-radius: 20px;
    background: rgba(255,255,255,0.8);

    box-shadow: 0 4px 20px rgba(255, 159, 0, 0.6); /* Glowing shadow */
    transition: transform 0.4s, box-shadow 0.4s;
}

.shop-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 6px 25px rgba(255, 159, 0, 1);
}

.btn-enter {
    background-color: #e91e63; /* Bright, game-themed color */
    color: #fff;
    border-radius: 30px;
    padding: 12px 28px;
}

.btn-enter:hover {
    background-color: #d81b60;
}

.btn-icon {
    font-size: 1.75rem;
    color: darkblue;
    transition: color 0.3s, transform 0.3s;
}

.btn-icon:hover {
    color: #00bcd4;
    transform: rotate(15deg);
}
.nav-tabs .nav-link {
    border: 1px solid transparent;
    border-radius: 12px;
    background-color: #f1f1f1;
    color: #555;
    padding: 10px 20px;
    margin: 5px;
    transition: background-color 0.3s, color 0.3s;
}

.nav-tabs .nav-link:hover {
    background-color: #d1d1d1;
    color: #333;
}

.nav-tabs .nav-link.active {
    background-color: #007bff;
    color: #fff;
    font-weight: bold;
    box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4);
}

        .shop-item-card {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    padding: 15px;
    width: 220px;
    text-align: center;
    transition: transform 0.3s, box-shadow 0.3s;
}

.shop-item-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}
#itemSection{
 padding: 10px 60px;
}
.shop-item-title {
    font-size: 20px;
    font-weight: bold;
    color: #333;
    margin-bottom: 8px;
    text-transform: uppercase;
}

.shop-item-card img {
    border-radius: 10px;
    object-fit: cover;
    width: 100%;
    height: 140px;
    margin-bottom: 10px;
}

        #currentShop {
    font-size: 2.5rem;
    font-weight: 800;
    color: #ff6b6b;
    background: linear-gradient(90deg, #ff6b6b, #f06595);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    margin-top: 20px;
}

#currentShop::after {
    content: '';
    display: block;
    width: 60px;
    height: 4px;
    background-color: #ff6b6b;
    margin: 8px auto 0;
    border-radius: 2px;
}
#room-container {
    position: relative;
    width: 800px;
    height: 600px;
    background-image: url('../static/img/room-background.jpg'); /* Update to your actual image path */
    background-size: cover; /* Scale the image to cover the entire div */
    background-position: center; /* Center the image */
    border: 2px solid #000;
    overflow: hidden; /* Prevent items from going outside the container */
    display: block;
    margin: 0 auto;
}

#roomCanvas {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1; /* Ensure the canvas is above the background image */
}

#backButton {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 2; /* Ensure the button is above the canvas */
}


#item-list {
    margin-top: 20px;
    display: flex;
    gap: 10px;
}

.item {
    cursor: grab;
    border: 1px solid #ccc;
    padding: 10px;
    background-color: white;
}

    </style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.5/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container mt-5">
                 <div class="modal fade" id="shopDescriptionModal" tabindex="-1" aria-labelledby="shopDescriptionModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="shopDescriptionModalLabel">Shop Description</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h4 id="shopName"></h4>
        <p id="shopDescription"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

        <div class="card task-card mt-5">
            <div class="card-header">
                <h1 class="text-center">Langer Economics</h1>
            </div>
            <div class="card-body">
                <div id="startSection" class="text-center px-5 py-5">
                    <h2>Welcome to the Economics Mini-Task!</h2>
                    <ul class="text-start mx-auto" style="max-width: 600px;">
                        <li class="mt-4">You have a budget of $5000.</li>
                        <li>Buy one item from each category in every shop (16 items total).</li>
                        <li>Review what others bought through the survey results.</li>
                    </ul>
                    <button class="btn btn-task mt-4" onclick="showShopSection()">Start!</button>
                </div>

<div id="shopSection" style="display:none;">



<div class="row mb-5">
    <div class="col-md-12 d-flex justify-content-between align-items-center modern-section">
        <div>
            <button class="btn btn-view-room modern-btn" onclick="showRoom('shopSection')">
                <i class="bi bi-house-door-fill"></i> View Room
            </button>
        </div>
        <div class="text-end">
            <h4 class="available-budget modern-budget">Budget: <span class="budget-amount">$<span class="availableBudget"></span></span></h4>
            <button class="btn btn-see-data modern-btn" onclick="showPurchasedItems()">
                <i class="bi bi-receipt-cutoff"></i> Receipt
            </button>
        </div>
    </div>
</div>


    <div class="row">
        <div class="col-md-3">
            <div class="card shop-card">
                <img class="shop-img" src="../static/img/kitcenkingdom.png" alt="Kitchen Kingdom">
                <div class="card-body">
                    <button class="btn btn-enter" onclick="showItems('shop1', 'Kitchen Kingdom')">Enter</button>
                </div>
                <button class="btn btn-info btn-icon" data-bs-toggle="modal" data-bs-target="#shopDescriptionModal" onclick="loadDescription('Kitchen Kingdom', 'Home & Kitchen essentials for everyone!')">
                    <i class="bi bi-info-circle"></i> <!-- Bootstrap Icons info circle -->
                </button>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shop-card">
                <img class="shop-img" src="../static/img/techhaven.png" alt="Kitchen Kingdom">
                <div class="card-body">
                    <button class="btn btn-enter" onclick="showItems('shop2', 'Tech Haven')">Enter</button>
                </div>
                <button class="btn btn-info btn-icon" data-bs-toggle="modal" data-bs-target="#shopDescriptionModal" onclick="loadDescription('Tech Haven', 'Cutting-edge technology and gadgets for the modern world.')">
                    <i class="bi bi-info-circle"></i> <!-- Bootstrap Icons info circle -->
                </button>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shop-card">
                <img class="shop-img" src="../static/img/officeoasis.png" alt="Kitchen Kingdom">
                <div class="card-body">
                    <button class="btn btn-enter" onclick="showItems('shop3', 'Office Oasis')">Enter</button>
                </div>
                <button class="btn btn-info btn-icon" data-bs-toggle="modal" data-bs-target="#shopDescriptionModal" onclick="loadDescription('Office Oasis', 'Furnishing and supplies to make your office a productive haven.')">
                    <i class="bi bi-info-circle"></i> <!-- Bootstrap Icons info circle -->
                </button>
            </div>
        </div>


                <div class="col-md-3">
            <div class="card shop-card">
                <img class="shop-img" src="../static/img/cozyliving.png" alt="Kitchen Kingdom">
                <div class="card-body">
                    <button class="btn btn-enter" onclick="showItems('shop4', 'Cozy Living')">Enter</button>
                </div>
                <button class="btn btn-info btn-icon" data-bs-toggle="modal" data-bs-target="#shopDescriptionModal" onclick="loadDescription('Cozy Living', 'Comfortable furniture and home essentials to create your cozy space.')">
                    <i class="bi bi-info-circle"></i> <!-- Bootstrap Icons info circle -->
                </button>
            </div>
        </div>
    </div>

    <div id="finishTaskBtnContainer">
        <button class="btn btn-success" onclick="finishTask()">Finish Task</button>
    </div>
</div>



 <div id="itemSection" style="display:none;">
<div class="row mb-5">
    <div class="col-md-12 d-flex justify-content-between align-items-center modern-section">
        <div>
            <button class="btn btn-view-room modern-btn" onclick="showRoom('itemSection')">
                <i class="bi bi-house-door-fill"></i> View Room
            </button>
        </div>
        <div class="text-end">
            <h4 class="available-budget modern-budget">Budget: <span class="budget-amount">$<span class="availableBudget"></span></span></h4>
            <button class="btn btn-see-data modern-btn" onclick="showPurchasedItems()">
                <i class="bi bi-receipt-cutoff"></i> Receipt
            </button>
        </div>
    </div>
</div>

<div class="col-md-12 d-flex justify-content-between align-items-center">
    <h2 id="currentShop" class="mt-5">Current Store: </h2>

<div id="chartsContainer">

</div>

</div>
 <ul class="nav nav-tabs mb-3" id="categoryTabs" role="tablist">
    {% for j in range(1, 17) %}
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if j == 1 %}active{% endif %}"
                id="category{{ j }}-tab"
                data-bs-toggle="tab"
                data-bs-target="#category{{ j }}"
                data-index="{{ j - 1 }}"
                type="button"
                role="tab"
                aria-controls="category{{ j }}"
                aria-selected="{{ j == 1 }}">
            Category {{ j }}
        </button>
    </li>
    {% endfor %}
</ul>



    <div class="tab-content" id="categoryTabsContent">
        {% for j in range(1, 5) %}
        <div class="tab-pane fade {% if j == 1 %}show active{% endif %}"
             id="category{{ j }}"
             role="tabpanel"
             aria-labelledby="category{{ j }}-tab">
            <div class="shop-items-grid" id="category{{ j }}-items"></div>
            <!-- Placeholder for category chart -->
            <div id="category{{ j }}-chart" class="category-chart" style="display:none;"></div>
        </div>
        {% endfor %}
    </div>

    <div class="text-center mt-4">
        <button class="btn btn-primary" onclick="goBackShop()">Back to Shops</button>
    </div>
</div>
    <div id="room-container" style="display: none;">
        <canvas id="roomCanvas" width="800" height="600"></canvas>
    </div>

            </div>
        </div>


<div id="item-list">
    <!-- Dynamically generated list of purchased items -->
</div>

    </div>

    <!-- Purchased Items Modal -->
    <div class="modal fade" id="purchasedItemsModal" tabindex="-1" aria-labelledby="purchasedItemsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="purchasedItemsModalLabel">Your Purchased Items</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul id="purchasedItemsList"></ul>

                </div>
            </div>
        </div>
    </div>

    <script>
const categoryMapping = {
    "category1": "Fridge",
    "category2": "Oven",
    "category3": "Stove",
    "category4": "Microwave",
    "category5": "TV",
    "category6": "Speaker",
    "category7": "Vacuum Cleaner",
    "category8": "AC/Heater",
    "category9": "Lamp",
    "category10": "Desk",
    "category11": "Office Chair",
    "category12": "Dining Table",
    "category13": "Sofa",
    "category14": "Bed",
    "category15": "Chair",
    "category16": "Dresser"
};

const surveyData = {
    "Fridge": [12, 8, 15, 10],
    "Oven": [9, 14, 11, 7],
    "Stove": [10, 6, 12, 14],
    "Microwave": [8, 16, 10, 6],
    "TV": [18, 12, 8, 5],
    "Speaker": [10, 7, 15, 12],
    "Vacuum Cleaner": [6, 11, 14, 10],
    "AC/Heater": [14, 10, 12, 8],
    "Lamp": [10, 8, 14, 12],
    "Desk": [9, 15, 10, 6],
    "Office Chair": [8, 12, 14, 10],
    "Dining Table": [7, 10, 16, 9],
    "Sofa": [15, 11, 8, 10],
    "Bed": [14, 12, 9, 10],
    "Chair": [12, 8, 14, 10],
    "Dresser": [10, 6, 15, 9]
};
        let previousSection = '';


function showRoom(currentSectionId) {
    previousSection = currentSectionId;
    document.getElementById(currentSectionId).style.display = 'none';
    document.getElementById('room-container').style.display = 'block';
}


function goBack() {
    if (previousSection) {
        document.getElementById(previousSection).style.display = 'block';
    }
    document.getElementById('room-container').style.display = 'none';
}


let availableBudget = 5000;
let purchasedItems = [];
let purchasedCategories = {}; // Tracks purchased items by category

// Shop data with categories and generated items
const shopData = {
    'shop1': {
        categories: ["Fridge", "Oven", "Stove", "Microwave"],
        items: generateItems(["Fridge", "Oven", "Stove", "Microwave"])
    },
    'shop2': {
        categories: ["TV", "Speaker", "Vacuum Cleaner", "AC/Heater"],
        items: generateItems(["TV", "Speaker", "Vacuum Cleaner", "AC/Heater"])
    },
    'shop3': {
        categories: ["Lamp", "Desk", "Office Chair", "Dining Table"],
        items: generateItems(["Lamp", "Desk", "Office Chair", "Dining Table"])
    },
    'shop4': {
        categories: ["Sofa", "Bed", "Chair", "Dresser"],
        items: generateItems(["Sofa", "Bed", "Chair", "Dresser"])
    }
};


function generateItems(categories) {
    const items = {};
    categories.forEach(category => {
        items[category] = getCategoryItems(category);
    });
    return items;
}

function getCategoryItems(category) {
    const itemsList = {
        "Fridge": [
            { name: "Luxury 2-door Fridge", price: 1299, image: "../static/img/shop1/fridge1.png", description: "A spacious fridge with advanced cooling technology and ice maker." },
            { name: "Modern 2-door Fridge", price: 1099, image: "../static/img/shop1/fridge2.png", description: "Energy-efficient fridge with smart controls." },
            { name: "One-door Fridge", price: 799, image: "../static/img/shop1/fridge3.png", description: "Compact fridge perfect for small kitchens." },
            { name: "Mini One-door Fridge", price: 399, image: "../static/img/shop1/fridge4.png", description: "Portable fridge for drinks and snacks." }
        ],
        "Oven": [
            { name: "Luxury Oven", price: 1099, image: "../static/img/shop1/oven1.jpg", description: "Oven with multiple cooking modes and self-cleaning feature." },
            { name: "Modern Oven", price: 899, image: "../static/img/shop1/oven2.jpg", description: "Stylish oven with precise temperature control." },
            { name: "Basic Oven", price: 599, image: "../static/img/shop1/oven3.jpg", description: "Reliable oven for everyday baking." },
            { name: "Compact Oven", price: 299, image: "../static/img/shop1/oven4.jpg", description: "Small oven for quick meals and snacks." }
        ],
        "Stove": [
            { name: "Luxury Stove", price: 1099, image: "../static/img/shop1/stove1.jpg", description: "Oven with multiple cooking modes and self-cleaning feature." },
            { name: "Modern Stove", price: 899, image: "../static/img/shop1/stove2.jpg", description: "Stylish oven with precise temperature control." },
            { name: "Basic Stove", price: 599, image: "../static/img/shop1/stove3.jpg", description: "Reliable oven for everyday baking." },
            { name: "Compact Stove", price: 299, image: "../static/img/shop1/stove4.jpg", description: "Small oven for quick meals and snacks." }
        ],
        "Microwave": [
            { name: "Luxury Microwave", price: 1099, image: "../static/img/shop1/microwave1.jpg", description: "Oven with multiple cooking modes and self-cleaning feature." },
            { name: "Modern Microwave", price: 899, image: "../static/img/shop1/microwave2.jpg", description: "Stylish oven with precise temperature control." },
            { name: "Basic Microwave", price: 599, image: "../static/img/shop1/microwave3.jpg", description: "Reliable oven for everyday baking." },
            { name: "Compact Microwave", price: 299, image: "../static/img/shop1/microwave4.jpg", description: "Small oven for quick meals and snacks." }
        ],
        "TV": [
          { name: "Samsung 98' 8K TV", price: 3299, image: "../static/img/shop2/TV1.png", description: "Massive 8K TV with breathtaking visuals." },
          { name: "LG 65' 4K TV", price: 1599, image: "../static/img/shop2/TV2.png", description: "OLED TV with vivid colors and deep blacks." },
          { name: "Sony 55' 4K TV", price: 999, image: "../static/img/shop2/TV3.png", description: "55-inch TV with immersive sound and picture." },
          { name: "Vizio 42' HD TV", price: 499, image: "../static/img/shop2/TV4.png", description: "Affordable HD TV with great performance." }
      ],
      "Speaker": [
          { name: "KEF LS50 Wireless Speaker", price: 2999, image: "../static/img/shop2/Speaker1.png", description: "High-end speaker with premium sound quality." },
          { name: "Bose SoundLink", price: 499, image: "../static/img/shop2/Speaker2.png", description: "Portable Bluetooth speaker with deep bass." },
          { name: "Sony Home Speaker", price: 199, image: "../static/img/shop2/Speaker3.png", description: "Speaker with 360-degree sound and voice control." },
          { name: "JBL Flip 6", price: 129, image: "../static/img/shop2/Speaker4.png", description: "Waterproof Bluetooth speaker for outdoor use." }
      ],
      "Vacuum Cleaner":[
          {name: "dreame X40 Ultra Robotic Vacuum", price: 1399.99, image: "../static/img/shop2/Vacuum1.png", description: "Wi-Fi enabled, self-emptying, 6 cleaning modes, avanced HEPA, voice control compatible"},
          {name: "iRobot Roomba Combo 10 Max", price: 1249.99, image: "../static/img/shop2/Vacuum2.png",description: "120V, 5 cleaning modes, HEPA filters, cordless, 60-minute battery life"},
          {name: "Dyson V15 Detect Absolute Cordless", price: 599.99, image: "../static/img/shop2/Vacuum3.png",description: "120V, 3 cleaning modes, bagless, HEPA filter"},
          {name: "Dyson V7 Advanced All Attachments", price: 259.99, image: "../static/img/shop2/Vacuum4.png", description: "115V power, lightweight, compact"}
      ],


      "AC/Heater":[
          {name: "Hoffman Spectracool AC 115V 6000 BTU indoor", price: 4357.00, image: "../static/img/shop2/AC1.png", description: "Ceiling type"},
          {name: "LG-12k Cooling + Heating", price: 1608.35, image: "../static/img/shop2/AC2.png", description: "Wall mounted"},
          {name: "Dyson Purifier Hot+Cool Formaldehyde HP09", price: 849.99, image: "../static/img/shop2/AC3.png", description: "Floor standing"},
          {name: "GoveeLife 42 Tower Fan 150 rotation", price: 149.99, image: "../static/img/shop2/AC4.png", description: "Portable, very small"}
],
        "Sofa": [
            { name: "Luxury Leather Sofa", price: 2499, image: "https://via.placeholder.com/150?text=Sofa", description: "Comfortable leather sofa with deep seating." },
            { name: "Modern Fabric Sofa", price: 1299, image: "https://via.placeholder.com/150?text=Sofa", description: "Fabric sofa with contemporary design." },
            { name: "Corner Sofa", price: 999, image: "https://via.placeholder.com/150?text=Sofa", description: "Corner sofa that maximizes seating space." },
            { name: "Basic Sofa", price: 599, image: "https://via.placeholder.com/150?text=Sofa", description: "Everyday sofa with great comfort." }
        ],
        "Bed": [
            { name: "King Size Bed", price: 1799, image: "https://via.placeholder.com/150?text=Bed", description: "Spacious bed with plush mattress." },
            { name: "Queen Size Bed", price: 1499, image: "https://via.placeholder.com/150?text=Bed", description: "Comfortable bed for restful sleep." },
            { name: "Double Bed", price: 999, image: "https://via.placeholder.com/150?text=Bed", description: "Compact bed for guest rooms." },
            { name: "Single Bed", price: 599, image: "https://via.placeholder.com/150?text=Bed", description: "Simple bed ideal for small spaces." }
        ],
        "Chair": [
            { name: "Lounge Chair", price: 399, image: "https://via.placeholder.com/150?text=Chair", description: "Comfortable chair for relaxing." },
            { name: "Rocking Chair", price: 299, image: "https://via.placeholder.com/150?text=Chair", description: "Traditional rocking chair." },
            { name: "Dining Chair", price: 149, image: "https://via.placeholder.com/150?text=Chair", description: "Stylish dining chair." },
            { name: "Plastic Chair", price: 49, image: "https://via.placeholder.com/150?text=Chair", description: "Affordable plastic chair." }
        ],
                "Office Chair": [
            { name: "Lounge Office Chair", price: 399, image: "https://via.placeholder.com/150?text=Office_Chair", description: "Comfortable chair for relaxing." },
            { name: "Rocking Office Chair", price: 299, image: "https://via.placeholder.com/150?text=Office_Chair", description: "Traditional rocking chair." },
            { name: "Dining Office Chair", price: 149, image: "https://via.placeholder.com/150?text=Office_Chair", description: "Stylish dining chair." },
            { name: "Plastic Office Chair", price: 49, image: "https://via.placeholder.com/150?text=Office_Chair", description: "Affordable plastic chair." }
        ],
                        "Dining Table": [
            { name: "Lounge Dining Table", price: 399, image: "https://via.placeholder.com/150?text=Dining_Table", description: "Comfortable chair for relaxing." },
            { name: "Rocking Dining Table", price: 299, image: "https://via.placeholder.com/150?text=Dining_Table", description: "Traditional rocking chair." },
            { name: "Dining Dining Table", price: 149, image: "https://via.placeholder.com/150?text=Dining_Table", description: "Stylish dining chair." },
            { name: "Plastic Dining Table", price: 49, image: "https://via.placeholder.com/150?text=Dining_Table", description: "Affordable plastic chair." }
        ],
        "Dresser": [
            { name: "Modern Dresser", price: 999, image: "https://via.placeholder.com/150?text=Dresser", description: "Sleek modern dresser." },
            { name: "Wooden Dresser", price: 799, image: "https://via.placeholder.com/150?text=Dresser", description: "Elegant wooden dresser." },
            { name: "Compact Dresser", price: 599, image: "https://via.placeholder.com/150?text=Dresser", description: "Small dresser for tight spaces." },
            { name: "Basic Dresser", price: 399, image: "https://via.placeholder.com/150?text=Dresser", description: "Simple and functional dresser." }
        ],
        "Lamp": [
            { name: "Philips Hue Table Lamp", price: 199, image: "https://via.placeholder.com/150?text=Lamp", description: "Smart lamp with color-changing options." },
            { name: "Ikea Floor Lamp", price: 99, image: "https://via.placeholder.com/150?text=Lamp", description: "Simple and elegant floor lamp." },
            { name: "Bedside Lamp", price: 49, image: "https://via.placeholder.com/150?text=Lamp", description: "Compact lamp perfect for nightstands." },
            { name: "Desk Lamp", price: 39, image: "https://via.placeholder.com/150?text=Lamp", description: "Adjustable desk lamp for study or work." }
        ],
        "Desk": [
            { name: "Standing Desk", price: 799, image: "https://via.placeholder.com/150?text=Desk", description: "Height-adjustable standing desk." },
            { name: "Office Desk", price: 499, image: "https://via.placeholder.com/150?text=Desk", description: "Spacious desk for office use." },
            { name: "Compact Study Desk", price: 299, image: "https://via.placeholder.com/150?text=Desk", description: "Small desk ideal for students." },
            { name: "Basic Wooden Desk", price: 199, image: "https://via.placeholder.com/150?text=Desk", description: "Simple desk with a wooden finish." }
        ]
    };
    return itemsList[category] || [];
}

function showShopSection() {
    updateAvailableBudget();
    document.getElementById('startSection').style.display = 'none';
    document.getElementById('shopSection').style.display = 'block';
}
function showItems(shopId, shopName) {
    document.getElementById('shopSection').style.display = 'none';
    document.getElementById('itemSection').style.display = 'block';

    document.getElementById('currentShop').innerText = shopName;

    const shop = shopData[shopId];
    const tabsContainer = document.getElementById('categoryTabs');
    const tabsContent = document.getElementById('categoryTabsContent');
    tabsContainer.innerHTML = ''; // Clear previous tabs
    tabsContent.innerHTML = ''; // Clear previous content

    Object.keys(shop.items).forEach((category, index) => {
        const categoryId = `category${index + 1}`;

        // Create tab for the category
        const tab = document.createElement('li');
        tab.classList.add('nav-item');
        tab.setAttribute('role', 'presentation');

        const tabButton = document.createElement('button');
        tabButton.classList.add('nav-link');
        if (index === 0) tabButton.classList.add('active'); // Set the first tab as active
        tabButton.id = `${categoryId}-tab`;
        tabButton.setAttribute('data-bs-toggle', 'tab');
        tabButton.setAttribute('data-bs-target', `#${categoryId}`);
        tabButton.setAttribute('type', 'button');
        tabButton.setAttribute('role', 'tab');
        tabButton.setAttribute('aria-controls', categoryId);
        tabButton.setAttribute('aria-selected', index === 0 ? 'true' : 'false');
        tabButton.innerText = `Category ${index + 1}`;

        tab.appendChild(tabButton);
        tabsContainer.appendChild(tab);

        // Create tab content for the category
        const content = document.createElement('div');
        content.classList.add('tab-pane', 'fade');
        if (index === 0) content.classList.add('show', 'active'); // Show the first tab content by default
        content.id = categoryId;
        content.setAttribute('role', 'tabpanel');
        content.setAttribute('aria-labelledby', `${categoryId}-tab`);

        // Create items grid
        const itemsGrid = document.createElement('div');
        itemsGrid.classList.add('shop-items-grid');
        itemsGrid.id = `${categoryId}-items`;

        // Populate items for the category
        shop.items[category].forEach(item => {
            const card = document.createElement('div');
            card.classList.add('shop-item-card');

            const img = document.createElement('img');
            img.src = item.image;
            img.alt = item.name;
            img.style.width = "100px";
            img.style.height = "200px";

            const itemTitle = document.createElement('h5');
            itemTitle.classList.add('shop-item-title', 'mt-4');
            itemTitle.innerText = `${item.name} - $${item.price}`;

            const buyButton = document.createElement('button');
            buyButton.classList.add('btn', 'btn-buy');
            buyButton.innerText = 'Buy';
            buyButton.onclick = () => buyItem(item, category, buyButton);
            buyButton.setAttribute('data-category', category);

            card.appendChild(img);
            card.appendChild(itemTitle);
            card.appendChild(buyButton);
            itemsGrid.appendChild(card);
        });

        // Add items grid to content
        content.appendChild(itemsGrid);

        // Create chart container for the category
        const chartContainer = document.createElement('div');
        chartContainer.id = `${categoryId}-chart`;
        chartContainer.classList.add('category-chart', 'mt-4');
        chartContainer.style.display = index === 0 ? 'block' : 'none'; // Show the first chart by default
        content.appendChild(chartContainer);

        // Add content to tabs content
        tabsContent.appendChild(content);
    });

    // Render the chart for the active tab on first load
    const firstCategoryId = `category1`; // Assuming the first tab corresponds to category1
    const firstCategoryName = categoryMapping[firstCategoryId]; // Map to category name
    if (firstCategoryName) {
        renderChart(firstCategoryName); // Render the initial chart
    }

    // Add event listeners for tab switching to update charts
    const tabs = document.querySelectorAll(".nav-link");
    tabs.forEach((tab) => {
        tab.addEventListener("click", function () {
            const categoryId = this.getAttribute("aria-controls");
            const allCharts = document.querySelectorAll(".category-chart");
            allCharts.forEach(chart => chart.style.display = 'none'); // Hide all charts

            const activeChart = document.getElementById(`${categoryId}-chart`);
            if (activeChart) activeChart.style.display = 'block'; // Show the active chart
            const categoryName = categoryMapping[categoryId];
            if (categoryName) renderChart(categoryName); // Render the corresponding chart
        });
    });
}



function buyItem(item, category, button) {
    if (purchasedCategories[category]) {
        alert(`You already bought an item from the ${category} category.`);
        return;
    }

    if (availableBudget >= item.price) {
        availableBudget -= item.price;
        purchasedItems.push({ ...item, category });
        purchasedCategories[category] = item;

        updateAvailableBudget();
        button.disabled = true;
        button.innerText = 'Purchased';
        alert(`You bought ${item.name} for $${item.price}.`);

        // Place the purchased item in the virtual room
        placeItemInRoom(item);
    } else {
        alert('Insufficient budget!');
    }
}


function undoPurchase(category) {
    if (!purchasedCategories[category]) {
        alert(`No item purchased from ${category} category to undo.`);
        return;
    }

    const item = purchasedCategories[category];
    availableBudget += item.price;
    purchasedItems = purchasedItems.filter(i => i.category !== category);
    delete purchasedCategories[category];

    // Remove the item from the room
    const itemIndex = itemsInRoom.findIndex(roomItem => roomItem.name === item.name);
    if (itemIndex !== -1) {
        itemsInRoom.splice(itemIndex, 1); // Remove item from the array
    }

    // Redraw the room to reflect the change
    drawRoom();

    updateAvailableBudget();
    updatePurchasedItemsList();
    enableBuyButton(category);
    alert(`Undo purchase of ${item.name}. Budget refunded.`);
}

function enableBuyButton(category) {
    const buttons = document.querySelectorAll(`[data-category="${category}"]`);
    buttons.forEach(button => {
        button.disabled = false;
        button.innerText = 'Buy';
    });
}

function updatePurchasedItemsList() {
    const list = document.getElementById('purchasedItemsList');
    list.innerHTML = purchasedItems.length
        ? purchasedItems.map(item =>
            `<li>${item.name} - $${item.price}
                <button onclick="undoPurchase('${item.category}')">Undo</button>
            </li>`).join('')
        : '<p>No items purchased yet.</p>';
}

function showPurchasedItems() {
    updatePurchasedItemsList();
    const modal = new bootstrap.Modal(document.getElementById('purchasedItemsModal'));
    modal.show();
}
function updateAvailableBudget() {
    document.querySelectorAll('.availableBudget').forEach(el => {
        el.innerText = Math.ceil(availableBudget); // Round up to the nearest integer
    });
}


function goBackShop() {
    document.getElementById('itemSection').style.display = 'none';
    document.getElementById('shopSection').style.display = 'block';
}

function renderChart(category) {
    const chartsContainer = document.getElementById('chartsContainer');
    if (!chartsContainer) return;

    // Clear any previous chart
    chartsContainer.innerHTML = '';

    // Create a new canvas element for the chart
    const canvas = document.createElement('canvas');
    canvas.id = `chart-${category}`;
    chartsContainer.appendChild(canvas);

    const ctx = canvas.getContext('2d');
    const data = surveyData[category]; // Assuming your data is keyed by category name

    if (!data) {
        console.error(`No data available for category: ${category}`);
        return;
    }

    // Render the chart
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Option 1', 'Option 2', 'Option 3', 'Option 4'], // Example labels
            datasets: [{
                label: `Purchases for ${category}`,
                data: data,
                backgroundColor: [
                    'rgba(75, 192, 192, 0.6)',
                    'rgba(54, 162, 235, 0.6)',
                    'rgba(255, 206, 86, 0.6)',
                    'rgba(153, 102, 255, 0.6)'
                ],
                borderColor: [
                    'rgba(75, 192, 192, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(153, 102, 255, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}



function onCategoryClick(categoryId) {
    const category = categoryMapping[categoryId];
    if (!category) {
        console.error(`No mapping found for categoryId: ${categoryId}`);
        return;
    }
    renderChart(category); // Draw the chart for the selected category
}


document.addEventListener("DOMContentLoaded", function () {
    const tabs = document.querySelectorAll(".nav-link");

    tabs.forEach((tab) => {
        tab.addEventListener("click", function () {
            const categoryId = this.getAttribute("aria-controls"); // Get the category ID from the 'aria-controls' attribute
            onCategoryClick(categoryId);
        });
    });
});





function finishTask() {
    const allCategories = Object.keys(purchasedCategories);
    const totalCategories = 16;

    if (allCategories.length === totalCategories) {
        alert('Congratulations! You have completed the task successfully.');
        window.location.href = "/task-completed";
    } else {
        const remaining = totalCategories - allCategories.length;
        alert(`You need to purchase ${remaining} more item(s) to finish the task.`);
    }
}

function loadDescription(shopName, description) {
    document.getElementById('shopName').innerText = shopName;
    document.getElementById('shopDescription').innerText = description;
}
document.addEventListener("DOMContentLoaded", function () {
    const tabs = document.querySelectorAll(".nav-link");

    tabs.forEach((tab) => {
        tab.addEventListener("click", function () {
            const category = this.getAttribute("aria-controls"); // Get the category ID from the 'aria-controls' attribute
            onCategoryClick(category);
        });
    });
});
    </script>
<script>
const canvas = document.getElementById('roomCanvas');
const ctx = canvas.getContext('2d');
const itemsInRoom = []; // Stores items placed in the room

let defaultPositionX = 50; // Initial position X for the first item
let defaultPositionY = 50; // Initial position Y for the first item
let selectedItem = null; // Item being dragged
let offsetX = 0; // X offset of the mouse from the item's origin
let offsetY = 0; // Y offset of the mouse from the item's origin

const MAX_ITEM_WIDTH = 100; // Maximum item width
const MAX_ITEM_HEIGHT = 100; // Maximum item height

// Preloaded images cache
const imageCache = {};

// Background image for the room
const backgroundImage = new Image();
backgroundImage.src = "../static/img/room-background.jpg"; // Replace with your image path

// Function to preload images
function preloadImage(src) {
    if (!imageCache[src]) {
        const img = new Image();
        img.src = src;
        imageCache[src] = img;
    }
    return imageCache[src];
}

// Function to draw the room with background and items
function drawRoom() {
    // Draw the background image
    if (backgroundImage.complete) {
        ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
        console.log("A");
    } else {
        backgroundImage.onload = () => {
            ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
            console.log("B");
        };
    }

    // Draw the items in the room
    itemsInRoom.forEach(item => {
        const img = preloadImage(item.image);
        if (img.complete) {
            // Calculate scaled dimensions based on original aspect ratio
            const aspectRatio = img.width / img.height;
            let width = MAX_ITEM_WIDTH;
            let height = MAX_ITEM_HEIGHT;

            if (aspectRatio > 1) {
                // Landscape image
                height = MAX_ITEM_HEIGHT / aspectRatio;
            } else {
                // Portrait image
                width = MAX_ITEM_WIDTH * aspectRatio;
            }

            ctx.drawImage(img, item.x, item.y, width, height);
        } else {
            // Wait for image to load before drawing
            img.onload = () => {
                drawRoom(); // Redraw room after the image is loaded
            };
        }
    });
}

// Function to place an item in the room
function placeItemInRoom(item) {
    if (itemsInRoom.length >= (canvas.width / MAX_ITEM_WIDTH) * (canvas.height / MAX_ITEM_HEIGHT)) {
        alert("Room is full!"); // Notify if the room is full
        return;
    }

    // Add the new item to the room at the default position
    itemsInRoom.push({ ...item, x: defaultPositionX, y: defaultPositionY });

    console.log("Item added to room:", item); // Debug log
    console.log("Items in room:", itemsInRoom); // Debug log

    // Adjust default positions for the next item
    defaultPositionX += MAX_ITEM_WIDTH + 10; // Increment X position with padding
    if (defaultPositionX + MAX_ITEM_WIDTH > canvas.width) {
        defaultPositionX = 50; // Reset X position if it exceeds canvas width
        defaultPositionY += MAX_ITEM_HEIGHT + 10; // Move to the next row with padding
    }

    if (defaultPositionY + MAX_ITEM_HEIGHT > canvas.height) {
        alert("No more space available in the room!"); // Notify if no more space is available
    }

    drawRoom(); // Re-render the room with the new item
}

// Function to buy an item
function buyItem(item, category, button) {
    if (purchasedCategories[category]) {
        alert(`You already bought an item from the ${category} category.`);
        return;
    }

    if (availableBudget >= item.price) {
        availableBudget -= item.price;
        purchasedItems.push({ ...item, category });
        purchasedCategories[category] = item;

        updateAvailableBudget();
        button.disabled = true;
        button.innerText = 'Purchased';
        alert(`You bought ${item.name} for $${item.price}.`);

        // Debug log to confirm item details before placing it in the room
        console.log("Placing item in room:", item);

        // Place the purchased item in the virtual room
        placeItemInRoom(item);
    } else {
        alert('Insufficient budget!');
    }
}

// Dragging functionality
canvas.addEventListener('mousedown', (event) => {
    const mouseX = event.offsetX;
    const mouseY = event.offsetY;

    // Check if an item is clicked
    selectedItem = itemsInRoom.find(item =>
        mouseX >= item.x &&
        mouseX <= item.x + MAX_ITEM_WIDTH &&
        mouseY >= item.y &&
        mouseY <= item.y + MAX_ITEM_HEIGHT
    );

    if (selectedItem) {
        offsetX = mouseX - selectedItem.x;
        offsetY = mouseY - selectedItem.y;
    }
});

canvas.addEventListener('mousemove', (event) => {
    if (selectedItem) {
        const mouseX = event.offsetX;
        const mouseY = event.offsetY;

        // Ensure item stays within canvas boundaries
        selectedItem.x = Math.min(Math.max(mouseX - offsetX, 0), canvas.width - MAX_ITEM_WIDTH);
        selectedItem.y = Math.min(Math.max(mouseY - offsetY, 0), canvas.height - MAX_ITEM_HEIGHT);

        drawRoom(); // Re-render the room
    }
});

canvas.addEventListener('mouseup', () => {
    selectedItem = null; // Stop dragging
});

// Add a Back button to the top-left corner of the room
const roomContainer = document.getElementById('room-container');
const backButton = document.createElement('button');
backButton.innerText = "Back";
backButton.classList.add('btn', 'btn-primary');
backButton.style.position = 'absolute';
backButton.style.top = '10px';
backButton.style.left = '10px';
backButton.style.zIndex = '10'; // Ensure it stays on top of the canvas
backButton.onclick = goBack;
roomContainer.appendChild(backButton);


</script>

{% endblock %}
