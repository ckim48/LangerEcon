{% extends "header.html" %}
{% block task %}
<head>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f9f9f9;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: auto;
            padding: 20px;
        }

        .task-card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background-color: #fff;
        }

        .card-header h1 {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
                    font-size: 2.5rem;
        color: #ff6b6b;
        }

        #startSection h2 {
            font-size: 1.85rem;
            color: #555;
        }

        #startSection ul {
            list-style: none;
            padding: 0;
            font-size: 1.2rem;
            color: #777;
        }

        #startSection ul li {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        #startSection ul li:before {
            content: "â€¢";
            color: #ff6b6b;
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-right: 10px;
        }

        .btn-task {
            background: linear-gradient(45deg, #ff6b6b, #f06595);
            border: none;
            color: #fff;
            font-size: 1rem;
            padding: 12px 24px;
            border-radius: 30px;
            transition: background 0.3s ease;
        }

        .btn-task:hover {
            background: linear-gradient(45deg, #f06595, #ff6b6b);
        }
#shopSection {
    position: relative;
}

#finishTaskBtnContainer {
    position: absolute;
    bottom: 20px;
    right: 20px;
}
.shop-card {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
    height: 250px;
    padding: 20px;
    position: relative;
}

.btn-icon {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: transparent;
    border: none;
    color: #007bff;
    font-size: 1.5rem;
    padding: 5px;
    cursor: pointer;
}

.btn-icon i {
    margin-right: 0;
}

.btn-icon:hover {
    background-color: transparent;
    color: #0056b3;
}
.shop-img {
    width: 100%;
    height: 80px;
    margin-top: 35px;
    object-fit: contain;
}
        .shop-card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 1.0rem;
            font-weight: 600;
            color: #333;
        }

 .btn-enter {
     width: 100px;
    background-color: #007bff;
    color: #fff;
    border-radius: 30px;
    padding: 10px 20px;
    margin-top: auto;
    transition: background 0.3s ease;
}

        .btn-enter:hover {
            background-color: #0056b3;
        }

        .shop-items-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

   .shop-item-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    padding: 15px;
    width: 220px;
    text-align: center;
    transition: transform 0.3s, box-shadow 0.3s;
}

.shop-item-title {
    font-size: 16px;
    font-weight: bold;
    color: #333;
    margin-bottom: 8px;
    text-transform: uppercase;
}

.shop-item-price {
    font-size: 16px;
    font-weight: bold;
    color: #555;
    margin-bottom: 12px;
}

.shop-item-card button {
    margin: 5px 0;
    padding: 10px 15px;
    border-radius: 5px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
}

.btn-buy {
    background-color: #28a745;
    color: white;
    border: none;
    transition: background-color 0.3s ease;
}

.btn-buy:hover {
    background-color: #218838;
}

.btn-detail {
    background-color: #007bff;
    color: white;
    padding: 8px 16px;
    border-radius: 5px;
    margin-right: 10px;
    transition: background-color 0.3s ease;
}

.btn-detail:hover {
    background-color: #0056b3;
}

.modal-content {
    border-radius: 15px;
}

.product-detail-content img {
    max-width: 100%;
    height: auto;
    border-radius: 10px;
    margin-bottom: 20px;
}


        #otherChoicesChart {
            width: 100%;
            height: 400px;
        }
        .btn-success{
            font-size: 19px;
            padding:10px 20px;
        }
#shopSection {
    background-image: url('../static/img/shoppingmall.jpg'); /* Replace with a stylized game mall background */
    background-size: cover;
    background-position: center;
    padding: 50px 30px;
    border-radius: 15px;
    position: relative;
    color: #fff;
}

#shopSection::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5); /* Slightly dark overlay for contrast */
    z-index: 1;
    border-radius: 15px;
}

.shop-card {
    position: relative;
    z-index: 2;
    border-radius: 20px;
    background: rgba(255,255,255,0.8);

    box-shadow: 0 4px 20px rgba(255, 159, 0, 0.6); /* Glowing shadow */
    transition: transform 0.4s, box-shadow 0.4s;
}

.shop-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 6px 25px rgba(255, 159, 0, 1);
}

.btn-enter {
    background-color: #e91e63; /* Bright, game-themed color */
    color: #fff;
    border-radius: 30px;
    padding: 12px 28px;
}

.btn-enter:hover {
    background-color: #d81b60;
}

.btn-icon {
    font-size: 1.75rem;
    color: darkblue;
    transition: color 0.3s, transform 0.3s;
}

.btn-icon:hover {
    color: #00bcd4;
    transform: rotate(15deg);
}
.nav-tabs .nav-link {
    border: 1px solid transparent;
    border-radius: 12px;
    background-color: #f1f1f1;
    color: #555;
    padding: 10px 20px;
    margin: 5px;
    transition: background-color 0.3s, color 0.3s;
}

.nav-tabs .nav-link:hover {
    background-color: #d1d1d1;
    color: #333;
}

.nav-tabs .nav-link.active {
    background-color: #007bff;
    color: #fff;
    font-weight: bold;
    box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4);
}
#shoppingStyleSurveySection{
    display:none;
}
        .shop-item-card {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    padding: 15px;
    width: 220px;
    text-align: center;
    transition: transform 0.3s, box-shadow 0.3s;
}

.shop-item-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}
#itemSection{
 padding: 10px 60px;
}
.shop-item-title {
    font-size: 16px;
    font-weight: bold;
    color: #333;
    margin-bottom: 8px;
    margin-top: 12px;
    text-transform: uppercase;
}

.shop-item-card img {
    border-radius: 10px;
    object-fit: contain; /* Preserve aspect ratio without cropping */
    width: 100%; /* Maintain full width of the card */
    height: auto; /* Adjust height automatically based on aspect ratio */
    margin-bottom: 10px;
}

        #currentShop {
    font-size: 2.5rem;
    font-weight: 800;
    color: #ff6b6b;
    background: linear-gradient(90deg, #ff6b6b, #f06595);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    margin-top: 20px;
}

#currentShop::after {
    content: '';
    display: block;
    width: 60px;
    height: 4px;
    background-color: #ff6b6b;
    margin: 8px auto 0;
    border-radius: 2px;
}
#room-container {
    position: relative;
    width: 800px;
    height: 600px;
    background-image: url('../static/img/room-background.jpg'); /* Update to your actual image path */
    background-size: cover; /* Scale the image to cover the entire div */
    background-position: center; /* Center the image */
    border: 2px solid #000;
    overflow: hidden; /* Prevent items from going outside the container */
    display: block;
    margin: 0 auto;
}

#roomCanvas {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1; /* Ensure the canvas is above the background image */
}

#backButton {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 2; /* Ensure the button is above the canvas */
}


#item-list {
    margin-top: 20px;
    display: flex;
    gap: 10px;
}
.price-tag {
    font-size: 14px;
    color: white;
    background-color: rgba(0, 0, 0, 0.7);
    padding: 5px;
    border-radius: 5px;
    position: absolute;
    z-index: 10; /* Ensure the price tag is above the item */
}

.item {
    cursor: grab;
    border: 1px solid #ccc;
    padding: 10px;
    background-color: white;
}

    </style>
    <style>
.survey-question {
    text-align: left;
    padding: 10px; /* Reduce padding */
    font-weight: 700;
    background-color: #fff;
    border-radius: 6px;
    margin-bottom: 10px; /* Reduce margin between questions */
}

.survey-question p {
    font-size: 16px; /* Slightly smaller font size */
    color: #333;
    margin-bottom: 5px; /* Reduce margin below the question */
    text-align: left;
}

.survey-options label {
    display: block;
    font-size: 15px; /* Smaller font size */
    font-weight: 400;
    color: #555;
    margin-bottom: 5px; /* Reduce space between options */
    cursor: pointer;
    transition: color 0.3s;
}

.survey-options input[type="radio"] {
    margin-right: 8px; /* Adjust spacing between radio button and label */
}

.submit-btn {
    align-self: center;
    padding: 10px 20px; /* Slightly smaller padding */
    background-color: #007BFF;
    color: #fff;
    font-size: 14px; /* Smaller font size */
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-top: 15px; /* Adjust space above the button */
}

    .submit-btn:hover {
        background-color: #0056b3;
    }

    .submit-btn:focus {
        outline: none;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .survey-container {
            padding: 20px;
        }

        .survey-header {
            font-size: 20px;
        }

        .survey-question p {
            font-size: 16px;
        }

        .survey-options label {
            font-size: 14px;
        }

        .submit-btn {
            width: 100%;
        }
    }
        #instruction-final{
            display:none;
        }


    .instruction-container {
        border-radius: 15px;
        padding: 40px;
        max-width: 900px;
        margin: auto;
        position: relative;
        overflow: hidden;
    }

    /* Header Styles */
    .instruction-header {
        font-size: 1.6rem;
        font-weight: 700;
        color: #ff6b6b;
        text-align: center;
        margin-bottom: 15px;
        background: linear-gradient(90deg, #ff6b6b, #f06595);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .instruction-subtitle {
        font-size: 1.5rem;
        color: #555;
        text-align: center;
        margin-bottom: 30px;
    }

    /* Instruction Content Styles */
    .instruction-content {
        font-size: 1.1rem;
        line-height: 1.8;
        color: #444;
        margin-bottom: 40px;
        text-align: left;
        padding: 0 20px;
    }

   .instruction-list {
    list-style: none;
    padding: 0;
    font-size: 1.2rem;
    color: #555;
    margin-left: 20px; /* Space for the bullet */
}
#instruction-final li{
        display: flex;
    align-items: center;
    margin-bottom: 15px;
    position: relative;
}

#instruction-final li:before {
    content: '';
    position: absolute;
    left: -20px; /* Adjust position of bullet */
    top: 50%;
    transform: translateY(-50%);
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: #ff6b6b; /* Bullet color */
    animation: pulse 1.5s ease-out infinite; /* Optional pulsing animation */
}

/* Hover effect */
#instruction-final li:hover {
    color: #ff6b6b; /* Change text color on hover */
    font-weight: bold;
}


.instruction-list li {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
    position: relative;
}

.instruction-list li:before {
    content: '';
    position: absolute;
    left: -20px; /* Adjust position of bullet */
    top: 50%;
    transform: translateY(-50%);
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: #ff6b6b; /* Bullet color */
    box-shadow: 0 0 10px rgba(255, 107, 107, 0.6); /* Glowing effect */
    animation: pulse 1.5s ease-out infinite; /* Optional pulsing animation */
}

/* Hover effect */
.instruction-list li:hover {
    color: #ff6b6b; /* Change text color on hover */
    font-weight: bold;
}


    /* Button Styles */
    .instruction-button {
        background-color: #ff6b6b;
        color: white;
        padding: 16px 40px;
        font-size: 1.2rem;
        border: none;
        border-radius: 50px;
        text-align: center;
        display: block;
        margin: 40px auto 0;
        cursor: pointer;
        transition: background-color 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .instruction-button:hover {
        background-color: #f06595;
    }

    .instruction-button:focus {
        outline: none;
    }

</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.5/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container mt-5">
                 <div class="modal fade" id="shopDescriptionModal" tabindex="-1" aria-labelledby="shopDescriptionModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="shopDescriptionModalLabel">Shop Description</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h4 id="shopName"></h4>
        <p id="shopDescription"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

        <!-- Product Detail Modal -->
<div class="modal fade" id="productDetailModal" tabindex="-1" aria-labelledby="productDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productDetailModalLabel">Product Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="product-detail-content text-center">
          <img id="productDetailImage" src="" alt="" class="img-fluid mb-3" style="max-height: 300px;">
          <h4 id="productDetailName"></h4>
          <p id="productDetailPrice"></p>
          <p id="productDetailDescription"></p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-buy btn-buy-modal">Buy</button>
      </div>
    </div>
  </div>
</div>


        <div class="card task-card mt-1">
            <div class="card-header">
                <h1 class="text-center">Virtual Shopping Task</h1>
            </div>
            <div class="card-body">
<div id="startSection" class=" px-5 py-5">
    <h2 class="mb-4">Welcome to the Virtual Mall!</h2>
    <div id="instructions" style="font-size:18px;">
        <!-- Instruction Page 1 -->
        <div class="instruction-page" id="instruction1">
            <p>Congratulations! Youâ€™re about to move into a new home!</p>
            <p>Thank you for visiting our Virtual Mall to shop for appliances and furniture for your new space.</p>
            <button class="btn btn-task mt-4" onclick="showNextInstruction(2)">Next</button>
        </div>
        <!-- Instruction Page 2 -->
        <div class="instruction-page" id="instruction2" style="display: none;">
            <p>Although we know youâ€™re on a limited budget, we hope you can maximize your satisfaction by making thoughtful purchase decisions.</p>
            <p>Our customers have diverse tastes and preferences when it comes to home products, so weâ€™ve prepared a variety of options for each product type just for you!</p>
            <button class="btn btn-task mt-4" onclick="showNextInstruction(3)">Next</button>
        </div>
        <!-- Instruction Page 3 -->
        <div class="instruction-page" id="instruction3" style="display: none;">
            <p>Additionally, weâ€™ve included information on which products have been chosen by other customers so far. </p>
            <p>Be sure to review the product descriptions and check out which options are the most popular before making your choices.</p>
            <button class="btn btn-task mt-4" onclick="showNextInstruction(4)">Next</button>
        </div>
        <!-- Instruction Page 4 -->
        <div class="instruction-page" id="instruction4" style="display: none;">
            <p>Before you begin shopping, weâ€™d like to understand your usual shopping style to better assist you. </p>
            <p>Please take a brief survey, and youâ€™ll be all set to start your shopping journey!</p>
            <button class="btn btn-task mt-4" onclick="startSurvey()">Take Survey</button>
        </div>
    </div>
</div>
<div id="shoppingStyleSurveySection" class="text-center px-5 py-5">
    <h2 class="mb-4">Shopping Style Survey</h2>
        <form id="shoppingStyleForm" class="survey-form">
        <!-- Question 1 -->
        <div class="survey-question">
        <p>1. What is your attitude toward owning designer or branded items (e.g., clothing, bags, watches)?</p>
        <div class="survey-options">
            <label><input type="radio" name="designerItems" value="A"> I donâ€™t consider brands when making purchases</label>
            <label><input type="radio" name="designerItems" value="B"> I actively avoid them</label>
            <label><input type="radio" name="designerItems" value="C"> I occasionally buy them if affordable</label>
            <label><input type="radio" name="designerItems" value="D"> I enjoy owning high-end brands and buy them if possible</label>
        </div>
        </div>

        <div class="survey-question">
        <p>2. How do you usually handle unexpected expenses (e.g., repairs, medical bills)?</p>
        <div class="survey-options">
            <label><input type="radio" name="handleUnexpectedExpenses" value="A"> Save and plan for them in advance</label>
            <label><input type="radio" name="handleUnexpectedExpenses" value="B"> Use a credit card or loan if needed</label>
            <label><input type="radio" name="handleUnexpectedExpenses" value="C"> Spend as needed without worrying too much</label>
            <label><input type="radio" name="handleUnexpectedExpenses" value="D"> Spend as wanted</label>
        </div>
        </div>

        <div class="survey-question">
        <p>3. If you received an unexpected bonus or windfall, how would you spend it?</p>
        <div class="survey-options">
            <label><input type="radio" name="windfallSpending" value="A"> Save or invest it</label>
            <label><input type="radio" name="windfallSpending" value="B"> Use it for practical needs (e.g., debt repayment, household items)</label>
            <label><input type="radio" name="windfallSpending" value="C"> Spend it on something luxurious or enjoyable</label>
            <label><input type="radio" name="windfallSpending" value="D"> Other</label>
        </div>
        </div>

        <div class="survey-question">
        <p>4. What is your perception of luxury?</p>
        <div class="survey-options">
            <label><input type="radio" name="luxuryPerception" value="A"> Luxury is unnecessary and wasteful</label>
            <label><input type="radio" name="luxuryPerception" value="B"> Luxury is something to enjoy occasionally</label>
            <label><input type="radio" name="luxuryPerception" value="C"> Luxury is a marker of success</label>
            <label><input type="radio" name="luxuryPerception" value="D"> Luxury indicates good quality products and can be bought occasionally if needed</label>
        </div>
        </div>
        <div class="survey-question">
        <p>5. How important is it for you to find products that are cost-effective or budget-friendly?</p>
        <div class="survey-options">
            <label><input type="radio" name="costEffectiveness" value="A"> Extremely important</label>
            <label><input type="radio" name="costEffectiveness" value="B"> Very important</label>
            <label><input type="radio" name="costEffectiveness" value="C"> Moderately important</label>
            <label><input type="radio" name="costEffectiveness" value="D"> Slightly important</label>
            <label><input type="radio" name="costEffectiveness" value="E"> Not important at all</label>
        </div>
        </div>

        <div class="survey-question">
        <p>6. How likely are you to prioritize luxury or premium features in a product, even if it means paying more?</p>
        <div class="survey-options">
            <label><input type="radio" name="luxuryPrioritization" value="A"> Very likely</label>
            <label><input type="radio" name="luxuryPrioritization" value="B"> Likely</label>
            <label><input type="radio" name="luxuryPrioritization" value="C"> Neutral</label>
            <label><input type="radio" name="luxuryPrioritization" value="D"> Unlikely</label>
            <label><input type="radio" name="luxuryPrioritization" value="E"> Very unlikely</label>
        </div>
        </div>

        <div class="survey-question">
        <p>7. When shopping, which of the following best describes your approach?</p>
        <div class="survey-options">
            <label><input type="radio" name="shoppingApproach" value="A"> I always seek the lowest price, even if the brand is unfamiliar.</label>
            <label><input type="radio" name="shoppingApproach" value="B"> I prefer affordable products but consider brand reputation.</label>
            <label><input type="radio" name="shoppingApproach" value="C"> I focus on finding reputable brands, even if they cost slightly more.</label>
            <label><input type="radio" name="shoppingApproach" value="D"> I prioritize premium or luxury brands, regardless of the price.</label>
        </div>
        </div>

        <div class="survey-question">
        <p>8. How willing are you to spend more for a product that is associated with a high-end or luxury brand?</p>
        <div class="survey-options">
            <label><input type="radio" name="willingnessForLuxury" value="A"> Very willing</label>
            <label><input type="radio" name="willingnessForLuxury" value="B"> Willing</label>
            <label><input type="radio" name="willingnessForLuxury" value="C"> Neutral</label>
            <label><input type="radio" name="willingnessForLuxury" value="D"> Unwilling</label>
            <label><input type="radio" name="willingnessForLuxury" value="E"> Very unwilling</label>
        </div>
        </div>

        <div class="survey-question">
        <p>9. Which statement best reflects your shopping behavior?</p>
        <div class="survey-options">
            <label><input type="radio" name="shoppingBehavior" value="A"> I buy products based on affordability and practicality.</label>
            <label><input type="radio" name="shoppingBehavior" value="B"> I consider both price and the brandâ€™s reputation.</label>
            <label><input type="radio" name="shoppingBehavior" value="C"> I am willing to pay more for products that represent luxury or exclusivity.</label>
            <label><input type="radio" name="shoppingBehavior" value="D"> My purchasing decisions vary depending on the product type.</label>
        </div>
        </div>

        <div class="survey-question">
        <p>10. How important are reviews or other peopleâ€™s opinions when you make a purchase?</p>
        <div class="survey-options">
            <label><input type="radio" name="reviewsImportance" value="A"> Very important â€“ I always read reviews before making a purchase</label>
            <label><input type="radio" name="reviewsImportance" value="B"> Somewhat important â€“ I read reviews for most products</label>
            <label><input type="radio" name="reviewsImportance" value="C"> Neutral â€“ I occasionally check reviews but donâ€™t rely heavily on them</label>
            <label><input type="radio" name="reviewsImportance" value="D"> Not very important â€“ I rarely read reviews</label>
            <label><input type="radio" name="reviewsImportance" value="E"> Not important at all â€“ I never consider other peopleâ€™s opinions</label>
        </div>
        </div>

        <div class="survey-question">
        <p>11. What do you usually do before making a major purchase (e.g., furniture, electronics)?</p>
        <div class="survey-options">
            <label><input type="radio" name="majorPurchasePrep" value="A"> Spend hours researching and comparing prices</label>
            <label><input type="radio" name="majorPurchasePrep" value="B"> Check for quality and warranty without focusing on price</label>
            <label><input type="radio" name="majorPurchasePrep" value="C"> Buy what feels right at the moment</label>
            <label><input type="radio" name="majorPurchasePrep" value="D"> Wait for recommendations or promotions</label>
        </div>
        </div>

        <div class="survey-question">
        <p>12. When making a purchase, how often do you pause to think about why you are buying the product?</p>
        <div class="survey-options">
            <label><input type="radio" name="pauseForReflection" value="A"> Always â€“ I reflect on my choices carefully</label>
            <label><input type="radio" name="pauseForReflection" value="B"> Often â€“ I consider it for most purchases</label>
            <label><input type="radio" name="pauseForReflection" value="C"> Sometimes â€“ I think about it for major purchases</label>
            <label><input type="radio" name="pauseForReflection" value="D"> Rarely â€“ I rely on impulse or habit</label>
        </div>
        </div>
        <div class="survey-question">
        <p>13. How often do advertisements or marketing influence your purchases?</p>
        <div class="survey-options">
            <label><input type="radio" name="adsInfluence" value="A"> Rarely â€“ I prefer to make independent decisions</label>
            <label><input type="radio" name="adsInfluence" value="B"> Sometimes â€“ I consider advertised products</label>
            <label><input type="radio" name="adsInfluence" value="C"> Frequently â€“ I am often drawn to advertised items</label>
            <label><input type="radio" name="adsInfluence" value="D"> Almost always â€“ Ads strongly influence my choices</label>
        </div>
        </div>
        <!-- Submit Button -->
        <button type="button" class="btn btn-task mt-4d-block mx-auto" onclick="submitSurvey()">Submit Survey</button>
    </form>
</div>
    <div class="instruction-container" id="instruction-final">
        <h1 class="instruction-header mb-5">Shopping Instructions</h1>
<!--        <h2 class="instruction-subtitle">Survey completed!</h2>-->
        <div class="instruction-content">
<ul>            <li> You have a limited budget of $1,5000.</li>
            <li>Visit 4 different shops, each offering 4 unique product types.</li>
            <li>You need to purchase all 16 item types for your new home.</li>
            <li>Each item has 4 options; choose the one that best fits your needs and preferences.</li>
            <li>Review the product descriptions carefully and see which options are the most popular before making your choices.</li>
            <li>Happy shopping!</li>
</ul>
        </div>
        <button class="instruction-button" onclick="showShopSection()">Start</button>
    </div>
<div id="shopSection" style="display:none;">



<div class="row mb-5">
    <div class="col-md-12 d-flex justify-content-between align-items-center modern-section">
        <div>
            <button class="btn btn-view-room modern-btn" onclick="showRoom('shopSection')">
                <i class="bi bi-house-door-fill"></i> View Room
            </button>
        </div>
        <div class="text-end">
            <h4 class="available-budget modern-budget">Budget: <span class="budget-amount">$<span class="availableBudget"></span></span></h4>
            <button class="btn btn-see-data modern-btn" onclick="showPurchasedItems()">
                <i class="bi bi-receipt-cutoff"></i> Receipt
            </button>
        </div>
    </div>
</div>


    <div class="row">
        <div class="col-md-3">
            <div class="card shop-card"  data-shop-id="shop1">
                <img class="shop-img" src="../static/img/kitcenkingdom.png" alt="Kitchen Kingdom">
                <div class="card-body">
                    <button class="btn btn-enter" onclick="showItems('shop1', 'Kitchen Kingdom')">Enter</button>
                </div>
                <button class="btn btn-info btn-icon" data-bs-toggle="modal" data-bs-target="#shopDescriptionModal" onclick="loadDescription('Kitchen Kingdom', 'Home & Kitchen essentials for everyone!')">
                    <i class="bi bi-info-circle"></i> <!-- Bootstrap Icons info circle -->
                </button>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shop-card" data-shop-id="shop2">
                <img class="shop-img" src="../static/img/techhaven.png" alt="Kitchen Kingdom">
                <div class="card-body">
                    <button class="btn btn-enter" onclick="showItems('shop2', 'Tech Haven')">Enter</button>
                </div>
                <button class="btn btn-info btn-icon" data-bs-toggle="modal" data-bs-target="#shopDescriptionModal" onclick="loadDescription('Tech Haven', 'Cutting-edge technology and gadgets for the modern world.')">
                    <i class="bi bi-info-circle"></i> <!-- Bootstrap Icons info circle -->
                </button>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shop-card" data-shop-id="shop3">
                <img class="shop-img" src="../static/img/officeoasis.png" alt="Kitchen Kingdom">
                <div class="card-body">
                    <button class="btn btn-enter" onclick="showItems('shop3', 'Office Oasis')">Enter</button>
                </div>
                <button class="btn btn-info btn-icon" data-bs-toggle="modal" data-bs-target="#shopDescriptionModal" onclick="loadDescription('Office Oasis', 'Furnishing and supplies to make your office a productive haven.')">
                    <i class="bi bi-info-circle"></i> <!-- Bootstrap Icons info circle -->
                </button>
            </div>
        </div>


                <div class="col-md-3">
            <div class="card shop-card" data-shop-id="shop4">
                <img class="shop-img" src="../static/img/cozyliving.png" alt="Kitchen Kingdom">
                <div class="card-body">
                    <button class="btn btn-enter" onclick="showItems('shop4', 'Cozy Living')">Enter</button>
                </div>
                <button class="btn btn-info btn-icon" data-bs-toggle="modal" data-bs-target="#shopDescriptionModal" onclick="loadDescription('Cozy Living', 'Comfortable furniture and home essentials to create your cozy space.')">
                    <i class="bi bi-info-circle"></i> <!-- Bootstrap Icons info circle -->
                </button>
            </div>
        </div>
    </div>

<div id="finishTaskBtnContainer" style="display: none;">
    <button class="btn btn-success" onclick="finishTask()">Finish Task</button>
</div>
</div>



 <div id="itemSection" style="display:none;">
<div class="row mb-5">
    <div class="col-md-12 d-flex justify-content-between align-items-center modern-section">
        <div>
            <button class="btn btn-view-room modern-btn" onclick="showRoom('itemSection')">
                <i class="bi bi-house-door-fill"></i> View Room
            </button>
        </div>
        <div class="text-end">
            <h4 class="available-budget modern-budget">Budget: <span class="budget-amount">$<span class="availableBudget"></span></span></h4>
            <button class="btn btn-see-data modern-btn" onclick="showPurchasedItems()">
                <i class="bi bi-receipt-cutoff"></i> Receipt
            </button>
        </div>
    </div>
</div>

<div class="col-md-12 d-flex justify-content-between align-items-center">
    <h2 id="currentShop" class="mt-5">Current Store: </h2>

<div id="chartsContainer">

</div>

</div>
 <ul class="nav nav-tabs mb-3" id="categoryTabs" role="tablist">
    {% for j in range(1, 17) %}
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if j == 1 %}active{% endif %}"
                id="category{{ j }}-tab"
                data-bs-toggle="tab"
                data-bs-target="#category{{ j }}"
                data-index="{{ j - 1 }}"
                type="button"
                role="tab"
                aria-controls="category{{ j }}"
                aria-selected="{{ j == 1 }}">
            Category {{ j }}
        </button>
    </li>
    {% endfor %}
</ul>



    <div class="tab-content" id="categoryTabsContent">
        {% for j in range(1, 5) %}
        <div class="tab-pane fade {% if j == 1 %}show active{% endif %}"
             id="category{{ j }}"
             role="tabpanel"
             aria-labelledby="category{{ j }}-tab">
            <div class="shop-items-grid" id="category{{ j }}-items"></div>
            <!-- Placeholder for category chart -->
            <div id="category{{ j }}-chart" class="category-chart" style="display:none;"></div>
        </div>
        {% endfor %}
    </div>

    <div class="text-center mt-4">
        <button class="btn btn-primary" onclick="goBackShop()">Back to Shops</button>
    </div>
</div>
    <div id="room-container" style="display: none;">
        <canvas id="roomCanvas" width="800" height="600"></canvas>
    </div>

            </div>
        </div>


<div id="item-list">
    <!-- Dynamically generated list of purchased items -->
</div>

    </div>

    <!-- Purchased Items Modal -->
    <div class="modal fade" id="purchasedItemsModal" tabindex="-1" aria-labelledby="purchasedItemsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="purchasedItemsModalLabel">Your Purchased Items</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul id="purchasedItemsList"></ul>

                </div>
            </div>
        </div>
    </div>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>

    function submitShoppingStyleSurvey() {
    const form = document.getElementById("shoppingStyleForm");
    const formData = new FormData(form);

    const responses = {};
    for (const [key, value] of formData.entries()) {
        responses[key] = value;
    }
    console.log("Shopping Style Survey Responses:", responses);

    alert("Thank you for completing the survey!");
            updateAvailableBudget();
    document.getElementById('shoppingStyleSurveySection').style.display = 'none';
        document.getElementById('shopSection').style.display = 'block';
}
</script>


      <script>
function updateFinishTaskButton() {
    const finishTaskBtn = document.getElementById('finishTaskBtnContainer');
    const totalCategories = 16; // Total number of categories
    const purchasedCategoriesCount = Object.keys(purchasedCategories).length;

    // Show the button if all categories have an item purchased
    finishTaskBtn.style.display = (purchasedCategoriesCount === totalCategories) ? 'block' : 'none';
}



function getCategoryItems(category) {
    const itemsList = {
        "Fridge": [
            { name: "Luxury 2-Door Fridge", price: 1299, image: "../static/img/shop1/fridge1.png", description: "This refrigerator redefines luxury with its sleek design, Wi-Fi connectivity, and smart cooling zones. Enjoy unparalleled convenience and energy efficiency in a stunning stainless steel finish." },
            { name: "Modern 2-Door Fridge", price: 1099, image: "../static/img/shop1/fridge2.png", description: "Elegant and eco-friendly, this fridge offers precise temperature control, ample storage, and a built-in water dispenser for a premium experience at an accessible price." },
            { name: "One-Door Fridge", price: 799, image: "../static/img/shop1/fridge3.png", description: "Reliable and practical, this refrigerator features adjustable shelves, a frost-free freezer, and a spacious crisper to keep your groceries fresh." },
            { name: "Mini One-Door Fridge", price: 399, image: "../static/img/shop1/fridge4.png", description: "Simple and efficient, this compact fridge is perfect for small spaces or tight budgets. Its quiet motor and adjustable storage make it a smart choice." }
        ],
        "Oven": [
            { name: "Luxury Oven", price: 1099, image: "../static/img/shop1/oven1.png", description: "Elevate your cooking with this dual-zone, smart touchscreen oven. It offers self-cleaning functionality and precision heat control for the ultimate kitchen upgrade." },
            { name: "Modern Oven", price: 899, image: "../static/img/shop1/oven2.png", description: "Stylish and versatile, this oven features advanced baking modes and an energy-efficient design thatâ€™s perfect for the everyday chef." },
            { name: "Basic Oven", price: 599, image: "../static/img/shop1/oven3.png", description: "Dependable and easy to use, this oven delivers consistent results with pre-set cooking programs and a spacious interior." },
            { name: "Compact Oven", price: 299, image: "../static/img/shop1/oven4.png", description: "Compact and affordable, this oven is ideal for simple, everyday cooking with easy-to-operate dials and quick heat-up times." }
        ],
        "Stove": [
            { name: "Luxury Stove", price: 1099, image: "../static/img/shop1/stove1.png", description: "A top-tier stove with precision induction heating, touch controls, and a sleek glass surface for seamless cooking and easy cleaning." },
            { name: "Modern Stove", price: 899, image: "../static/img/shop1/stove2.png", description: "This gas stove combines power and style with high-efficiency burners and a durable stainless-steel finish." },
            { name: "Basic Stove", price: 599, image: "../static/img/shop1/stove3.png", description: "A reliable stove with evenly heated coils and adjustable temperature settings, perfect for everyday cooking." },
            { name: "Compact Stove", price: 299, image: "../static/img/shop1/stove4.png", description: "Compact and efficient, this stove offers solid performance at an unbeatable price, ideal for small kitchens or limited budgets." }
        ],
        "Microwave": [
            { name: "Luxury Microwave", price: 1099, image: "../static/img/shop1/microwave1.png", description: "Experience ultimate convenience with voice control, pre-programmed settings, and even heating technology in a sleek, modern design." },
            { name: "Modern Microwave", price: 899, image: "../static/img/shop1/microwave2.png", description: "This microwave combines style and functionality with one-touch cooking presets and a spacious interior for family meals." },
            { name: "Basic Microwave", price: 599, image: "../static/img/shop1/microwave3.png", description: "Simple yet effective, this microwave offers all the essential features with a clean and compact design." },
            { name: "Compact Microwave", price: 299, image: "../static/img/shop1/microwave4.png", description: "Affordable and straightforward, this microwave is perfect for quick reheating and basic cooking needs." }
        ],
        "TV": [
            { name: "Samsung 98â€™ 8K TV", price: 3299, image: "../static/img/shop2/tv1.png", description: "Immerse yourself in cutting-edge visuals with this 8K Smart TV featuring HDR10+, Dolby Atmos, and a frameless design." },
            { name: "LG 65â€™ 4K TV", price: 1599, image: "../static/img/shop2/tv2.png", description: "Enjoy crisp 4K visuals, rich colors, and built-in streaming apps in a stylish, wall-mountable design." },
            { name: "SONY 55â€™ 4K TV", price: 999, image: "../static/img/shop2/tv3.png", description: "A dependable full-HD TV with vibrant colors, great sound, and essential smart features." },
            { name: "Vizio 42â€™ HD TV", price: 499, image: "../static/img/shop2/tv4.png", description: "A compact and affordable TV with sharp resolution, ideal for smaller spaces or second screens." }
        ],
        "Speaker": [
            { name: "KEF LS50 Wireless Speaker", price: 2999, image: "../static/img/shop2/speaker1.png", description: "Experience immersive audio with these high-fidelity speakers, featuring Bluetooth connectivity and premium materials." },
            { name: "Bose SoundLink", price: 499, image: "../static/img/shop2/speaker2.png", description: "Powerful bass, crisp treble, and a sleek design make this speaker perfect for music enthusiasts." },
            { name: "Sony Home Speaker", price: 199, image: "../static/img/shop2/speaker3.png", description: "A compact and versatile speaker with clear audio and wireless streaming at an affordable price." },
            { name: "JBL Flip 6", price: 129, image: "../static/img/shop2/speaker4.png", description: "Portable and cost-effective, this speaker is great for casual listening and easy on the wallet." }
        ],
        "Vacuum Cleaner": [
            { name: "dreame X40 Ultra Robotic Vacuum", price: 1399.99, image: "../static/img/shop2/vacuum1.png", description: "A robotic vacuum with smart mapping, voice control, and powerful suction for effortless cleaning." },
            { name: "iRobot Roomba Combo 10 Max", price: 1249.99, image: "../static/img/shop2/vacuum2.png", description: "Lightweight and cordless, this vacuum delivers strong suction and long battery life for hassle-free cleaning." },
            { name: "Dyson V15 Detect Absolute Cordless", price: 599.99, image: "../static/img/shop2/vacuum3.png", description: "A reliable, bagless vacuum with adjustable settings for carpets and hardwood floors." },
            { name: "Dyson V7 Advanced All Attachments", price: 259.99, image: "../static/img/shop2/vacuum4.png", description: "Compact and affordable, this vacuum is perfect for quick cleanups and small spaces." }
        ],
                "Chair": [
            { name: "Artisan Lounge Chair", price: 399, image: "../static/img/shop4/chair1.png", description: "A handcrafted chair with a modern design, premium materials, and unmatched comfort for any living space." },
            { name: "RelaxPro Chair", price: 299, image: "../static/img/shop4/chair2.png", description: "A cushioned accent chair with a stylish frame, perfect for reading or relaxing." },
            { name: "HomeComfort Chair", price: 149, image: "../static/img/shop4/chair3.png", description: "A sturdy and practical chair with a soft fabric finish, designed for everyday use." },
            { name: "BasicSeat Chair", price: 49, image: "../static/img/shop4/chair4.png", description: "Simple and affordable, this chair is ideal for extra seating or smaller spaces." }
        ],
        "AC/Heater": [
            { name: "Hoffman Spectracool AC 115V 6000 BTU indoor", price: 4357, image: "../static/img/shop2/ac1.png", description: "A smart, all-in-one AC and heater with app control, energy efficiency, and whisper-quiet operation." },
            { name: "LG-12k Cooling + Heating", price: 1608.35, image: "../static/img/shop2/ac2.png", description: "Combines powerful cooling and heating with a stylish design and remote control for convenience." },
            { name: "Dyson Purifier Hot+Cool Formaldehyde HP09", price: 849.99, image: "../static/img/shop2/ac3.png", description: "A reliable AC/heater unit with multiple fan speeds and adjustable temperature settings." },
            { name: "GoveeLife 42 Tower Fan 150 rotation", price: 149.99, image: "../static/img/shop2/ac4.png", description: "Affordable and compact, this unit is perfect for smaller rooms and budget-conscious buyers." }
        ],
        "Sofa": [
            { name: "Luxury Leather Sofa", price: 2499, image: "../static/img/shop4/sofa1.png", description: "Indulge in ultimate comfort with this spacious, modular sofa featuring plush cushions and high-end upholstery." },
            { name: "Modern Fabric Sofa", price: 1299, image: "../static/img/shop4/sofa2.png", description: "A stylish and versatile sofa with durable fabric and a pull-out bed option for added convenience." },
            { name: "Corner Sofa", price: 999, image: "../static/img/shop4/sofa3.png", description: "A comfortable 3-seater sofa with a modern design and soft cushions for everyday relaxation." },
            { name: "Basic Sofa", price: 599, image: "../static/img/shop4/sofa4.png", description: "Compact and affordable, this sofa is perfect for small spaces without compromising on comfort." }
        ],
        "Bed": [
            { name: "DreamRest Elite King", price: 1799, image: "../static/img/shop4/bed1.png", description: "A luxurious king-size bed with a memory foam mattress and a sleek, upholstered headboard for ultimate relaxation." },
            { name: "CozySleep Queen", price: 1499, image: "../static/img/shop4/bed2.png", description: "A sturdy queen-size bed frame with a supportive mattress for a restful nightâ€™s sleep." },
            { name: "ComfortBase Full", price: 999, image: "../static/img/shop4/bed3.png", description: "A reliable full-size bed with a simple yet durable design, perfect for everyday use." },
            { name: "EasyRest Twin", price: 599, image: "../static/img/shop4/bed4.png", description: "Affordable and functional, this twin-size bed is ideal for guest rooms or smaller spaces." }
        ],
                "Desk": [
            { name: "Workspace Pro Executive Desk", price: 799, image: "../static/img/shop3/desk1.png", description: "This premium desk features a spacious solid wood surface, built-in charging ports, and elegant craftsmanship for a luxurious workspace." },
            { name: "ModDesk 500", price: 499, image: "../static/img/shop3/desk2.png", description: "A sleek, height-adjustable desk with a durable finish, perfect for both work and study." },
            { name: "SimpleWork 300", price: 299, image: "../static/img/shop3/desk3.png", description: "A sturdy and practical desk with ample surface area and a minimalistic design that fits any space." },
            { name: "BasicDesk 200", price: 199, image: "../static/img/shop3/desk4.png", description: "Compact and affordable, this desk is perfect for small spaces and straightforward setups." }
        ],
        "Office Chair": [
            { name: "Lux Ergo Executive Chair", price: 399, image: "../static/img/shop3/oc1.png", description: "This ergonomic chair offers premium lumbar support, adjustable settings, and breathable materials for all-day comfort." },
            { name: "Comfywork Office Chair", price: 299, image: "../static/img/shop3/oc2.png", description: "A stylish and supportive chair with padded armrests, adjustable height, and a sleek design." },
            { name: "TaskMate Office Chair", price: 149, image: "../static/img/shop3/oc3.png", description: "A reliable chair with basic ergonomic features and a comfortable cushioned seat for everyday use." },
            { name: "SitEase Budget Chair", price: 49, image: "../static/img/shop3/oc4.png", description: "Affordable and compact, this chair is ideal for budget-conscious buyers." }
        ],
        "Dining Table": [
            { name: "Grand Dine Pro", price: 399, image: "../static/img/shop3/dt1.png", description: "A handcrafted solid wood dining table with an elegant finish and seating for up to 8 people, perfect for entertaining." },
            { name: "Modern Dining Table", price: 299, image: "../static/img/shop3/dt2.png", description: "A sleek glass-top table with a contemporary design, offering style and functionality for everyday meals." },
            { name: "SimpleDine Table 150", price: 149, image: "../static/img/shop3/dt3.png", description: "A durable, expandable table with a simple, timeless design for small to medium-sized gatherings." },
            { name: "CompactDine Table", price: 49, image: "../static/img/shop3/dt4.png", description: "Affordable and space-saving, this table is ideal for small kitchens or casual dining." }
        ],
        "Lamp": [
            { name: "Philips Hue Table Lamp", price: 199, image: "../static/img/shop3/lamp1.png", description: "A modern, touch-controlled lamp with customizable lighting modes and wireless charging." },
            { name: "Ikea Floor Lamp", price: 99, image: "../static/img/shop3/lamp2.png", description: "Stylish and functional, this lamp offers dimmable light and a USB charging port." },
            { name: "Bedside Lamp", price: 49, image: "../static/img/shop3/lamp3.png", description: "A simple, adjustable lamp with warm and cool light settings for everyday use." },
            { name: "Desk Lamp", price: 39, image: "../static/img/shop3/lamp4.png", description: "Affordable and compact, this lamp is perfect for desks or bedside tables." }
        ],
        "Dresser": [
            { name: "Modern Dresser", price: 999, image: "../static/img/shop4/dresser1.png", description: "A spacious, solid wood dresser with soft-close drawers and a polished finish for a touch of sophistication." },
            { name: "Wooden Dresser", price: 799, image: "../static/img/shop4/dresser2.png", description: "A sleek and modern dresser with ample storage and smooth-gliding drawers, blending style and utility." },
            { name: "Compact Dresser", price: 599, image: "../static/img/shop4/dresser3.png", description: "A functional dresser with a timeless design, offering plenty of storage for everyday needs." },
            { name: "Basic Dresser", price: 399, image: "../static/img/shop4/dresser4.png", description: "Compact and affordable, this dresser is perfect for smaller bedrooms or simple storage needs." }
        ]
    };
    return itemsList[category] || [];
}
const categoryMapping = {
    "category1": "Fridge",
    "category2": "Oven",
    "category3": "Stove",
    "category4": "Microwave",
    "category5": "TV",
    "category6": "Speaker",
    "category7": "Vacuum Cleaner",
    "category8": "AC/Heater",
    "category9": "Lamp",
    "category10": "Desk",
    "category11": "Office Chair",
    "category12": "Dining Table",
    "category13": "Sofa",
    "category14": "Bed",
    "category15": "Chair",
    "category16": "Dresser"
};
const surveyData = {
    "Fridge": { pollType: "Poll type 1", data: [20, 30, 30, 20] },
    "Oven": { pollType: "Poll type 2", data: [60, 20, 10, 10] },
    "Stove": { pollType: "Poll type 3", data: [10, 10, 20, 60] },
    "Microwave": { pollType: "Poll type 1", data: [20, 30, 30, 20] },
    "TV": { pollType: "Poll type 1", data: [20, 30, 30, 20] },
    "Speaker": { pollType: "Poll type 2", data: [60, 20, 10, 10] },
    "Vacuum Cleaner": { pollType: "Poll type 3", data: [10, 10, 20, 60] },
    "AC/Heater": { pollType: "Poll type 2", data: [60, 20, 10, 10] },
    "Lamp": { pollType: "Poll type 1", data: [20, 30, 30, 20] },
    "Desk": { pollType: "Poll type 3", data: [10, 10, 20, 60] },
    "Office Chair": { pollType: "Poll type 2", data: [60, 20, 10, 10] },
    "Dining Table": { pollType: "Poll type 3", data: [10, 10, 20, 60] },
    "Sofa": { pollType: "Poll type 1", data: [20, 30, 30, 20] },
    "Bed": { pollType: "Poll type 2", data: [60, 20, 10, 10] },
    "Chair": { pollType: "Poll type 3", data: [10, 10, 20, 60] },
    "Dresser": { pollType: "Poll type 1", data: [20, 30, 30, 20] }
};

       function submitSurvey() {
    const form = document.getElementById("shoppingStyleForm");
    const inputs = form.querySelectorAll('input[type="radio"]');
    const questions = [...new Set([...inputs].map(input => input.name))];
    const responses = {};

    // Validate all questions have answers
    let allAnswered = true;
    questions.forEach(question => {
        const selected = form.querySelector(`input[name="${question}"]:checked`);
        if (!selected) {
            allAnswered = false;
            // Highlight the unanswered question
            const questionElement = form.querySelector(`input[name="${question}"]`).closest('.survey-question');
            questionElement.style.border = '2px solid red'; // Highlight
            setTimeout(() => questionElement.style.border = '', 3000); // Remove after 3 seconds
        } else {
            responses[question] = selected.value;
        }
    });

    if (!allAnswered) {
        alert("Please answer all questions before submitting.");
        return;
    }

    // AJAX request to send data to the Flask server
    $.ajax({
        url: '/submit_survey',  // The Flask route to handle survey submission
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(responses),  // Send data as JSON
        success: function(response) {
            if (response.status === 'success') {
                alert("Survey submitted successfully!");
                document.getElementById('shoppingStyleSurveySection').style.display = 'none';
                document.getElementById('instruction-final').style.display = 'block';
            } else {
                alert("There was an error submitting the survey.");
            }
        },
        error: function(xhr, status, error) {
            console.log(error);
            alert("Failed to submit the survey.");
        }
    });
}

    </script>
    <script>

        function showNextInstruction(pageNumber) {

    document.querySelectorAll('.instruction-page').forEach(page => {
        page.style.display = 'none';
    });


    document.getElementById(`instruction${pageNumber}`).style.display = 'block';
}

function startSurvey() {



    document.getElementById('startSection').style.display = 'none';
    document.getElementById('shoppingStyleSurveySection').style.display = 'block';

}

        let previousSection = '';


function showRoom(currentSectionId) {
    previousSection = currentSectionId;
    document.getElementById(currentSectionId).style.display = 'none';
    document.getElementById('room-container').style.display = 'block';
}


function goBack() {
    if (previousSection) {
        document.getElementById(previousSection).style.display = 'block';
    }
    document.getElementById('room-container').style.display = 'none';
}


let availableBudget = 15000;
let purchasedItems = [];
let purchasedCategories = {}; // Tracks purchased items by category

// Shop data with categories and generated items
const shopData = {
    'shop1': {
        categories: ["Fridge", "Oven", "Stove", "Microwave"],
        items: generateItems(["Fridge", "Oven", "Stove", "Microwave"])
    },
    'shop2': {
        categories: ["TV", "Speaker", "Vacuum Cleaner", "AC/Heater"],
        items: generateItems(["TV", "Speaker", "Vacuum Cleaner", "AC/Heater"])
    },
    'shop3': {
        categories: ["Lamp", "Desk", "Office Chair", "Dining Table"],
        items: generateItems(["Lamp", "Desk", "Office Chair", "Dining Table"])
    },
    'shop4': {
        categories: ["Sofa", "Bed", "Chair", "Dresser"],
        items: generateItems(["Sofa", "Bed", "Chair", "Dresser"])
    }
};


function generateItems(categories) {
    const items = {};
    categories.forEach(category => {
        items[category] = getCategoryItems(category);
    });
    return items;
}



function showShopSection() {
    updateAvailableBudget();
    document.getElementById('startSection').style.display = 'none';
    document.getElementById('instruction-final').style.display = 'none';
    document.getElementById('shopSection').style.display = 'block';
}
        function updateShopStatus(shopId) {
    const shop = shopData[shopId];
    const categories = shop.categories;
    const allPurchased = categories.every(category => purchasedCategories[category]);

    const shopCard = document.querySelector(`[data-shop-id="${shopId}"]`);
    if (allPurchased) {
        let purchasedMessage = shopCard.querySelector('.purchased-message');
        if (!purchasedMessage) {
            purchasedMessage = document.createElement('div');
            purchasedMessage.classList.add('purchased-message');
            purchasedMessage.innerText = 'All items purchased!';
            purchasedMessage.style.color = '#28a745';
            purchasedMessage.style.fontWeight = 500;
            purchasedMessage.style.marginTop = '1px';
//            purchasedMessage.style.marginTop = '10px';
            shopCard.appendChild(purchasedMessage);
        }
    }
}
function showItems(shopId, shopName) {
    document.getElementById('shopSection').style.display = 'none';
    document.getElementById('itemSection').style.display = 'block';

    document.getElementById('currentShop').innerText = shopName;

    const shop = shopData[shopId];
    const tabsContainer = document.getElementById('categoryTabs');
    const tabsContent = document.getElementById('categoryTabsContent');
    tabsContainer.innerHTML = ''; // Clear previous tabs
    tabsContent.innerHTML = ''; // Clear previous content

    Object.keys(shop.items).forEach((category, index) => {
        const categoryId = `category${index + 1}`;

        // Create tab for the category
        const tab = document.createElement('li');
        tab.classList.add('nav-item');
        tab.setAttribute('role', 'presentation');

        const tabButton = document.createElement('button');
        tabButton.classList.add('nav-link');
        if (index === 0) tabButton.classList.add('active'); // Set the first tab as active
        tabButton.id = `${categoryId}-tab`;
        tabButton.setAttribute('data-bs-toggle', 'tab');
        tabButton.setAttribute('data-bs-target', `#${categoryId}`);
        tabButton.setAttribute('type', 'button');
        tabButton.setAttribute('role', 'tab');
        tabButton.setAttribute('aria-controls', categoryId);
        tabButton.setAttribute('aria-selected', index === 0 ? 'true' : 'false');
        tabButton.innerText = `Category ${index + 1}`;

        tab.appendChild(tabButton);
        tabsContainer.appendChild(tab);

        // Create tab content for the category
        const content = document.createElement('div');
        content.classList.add('tab-pane', 'fade');
        if (index === 0) content.classList.add('show', 'active'); // Show the first tab content by default
        content.id = categoryId;
        content.setAttribute('role', 'tabpanel');
        content.setAttribute('aria-labelledby', `${categoryId}-tab`);

        // Create items grid
        const itemsGrid = document.createElement('div');
        itemsGrid.classList.add('shop-items-grid');
        itemsGrid.id = `${categoryId}-items`;

        // Populate items for the category
        shop.items[category].forEach(item => {
            const card = document.createElement('div');
            card.classList.add('shop-item-card');

            const img = document.createElement('img');
            img.src = item.image;
            img.alt = item.name;
            img.style.width = "100%";
            img.style.height = "120px";

            const itemTitle = document.createElement('h5');
            itemTitle.classList.add('shop-item-title');
            itemTitle.innerText = item.name;

            const itemPrice = document.createElement('p');
            itemPrice.classList.add('shop-item-price');
            itemPrice.innerText = `$${item.price}`;

const detailButton = document.createElement('button');
detailButton.classList.add('btn', 'btn-detail','me-1');
detailButton.innerText = 'Details';
detailButton.onclick = () => showProductDetail(item, category);




            const buyButton = document.createElement('button');
            buyButton.classList.add('btn', 'btn-buy','ms-1');
            buyButton.innerText = 'Buy';
            buyButton.onclick = () => buyItem(item, category, buyButton);
            buyButton.setAttribute('data-category', category);

const buttonContainer = document.createElement('div');
buttonContainer.classList.add('button-container');
buttonContainer.appendChild(detailButton);
buttonContainer.appendChild(buyButton);

            card.appendChild(img);
            card.appendChild(itemTitle);
            card.appendChild(itemPrice);
            card.appendChild(buttonContainer);
            itemsGrid.appendChild(card);
        });

        // Add items grid to content
        content.appendChild(itemsGrid);

        // Create chart container for the category
        const chartContainer = document.createElement('div');
        chartContainer.id = `${categoryId}-chart`;
        chartContainer.classList.add('category-chart', 'mt-4');
        chartContainer.style.display = index === 0 ? 'block' : 'none'; // Show the first chart by default
        content.appendChild(chartContainer);

        // Add content to tabs content
        tabsContent.appendChild(content);
    });

    // Render the chart for the active tab on first load
    const firstCategoryId = `category1`; // Assuming the first tab corresponds to category1
    const firstCategoryName = categoryMapping[firstCategoryId]; // Map to category name
    if (firstCategoryName) {
        renderChart(firstCategoryName); // Render the initial chart
    }

    // Add event listeners for tab switching to update charts
    const tabs = document.querySelectorAll(".nav-link");
    tabs.forEach((tab) => {
        tab.addEventListener("click", function () {
            const categoryId = this.getAttribute("aria-controls");
            const allCharts = document.querySelectorAll(".category-chart");
            allCharts.forEach(chart => chart.style.display = 'none'); // Hide all charts

            const activeChart = document.getElementById(`${categoryId}-chart`);
            if (activeChart) activeChart.style.display = 'block'; // Show the active chart
            const categoryName = categoryMapping[categoryId];
            if (categoryName) renderChart(categoryName); // Render the corresponding chart
        });
    });
}

function buyItem(item, category, button) {
    if (purchasedCategories[category]) {
        alert(`You already bought an item from the ${category} category.`);
        return;
    }

    if (availableBudget >= item.price) {
        availableBudget -= item.price;
        purchasedItems.push({ ...item, category });
        purchasedCategories[category] = item;

        updateAvailableBudget();
        button.disabled = true;
        button.innerText = 'Purchased';

        // Place the purchased item in the room
        placeItemInRoom(item);

        alert(`You bought ${item.name} for $${item.price}.`);

        // Update shop status
        const shopId = Object.keys(shopData).find(shopId => shopData[shopId].categories.includes(category));
        if (shopId) updateShopStatus(shopId);

        // Update Finish Button
        updateFinishTaskButton();
    } else {
        alert('Insufficient budget!');
    }
}

function undoPurchase(category) {
    if (!purchasedCategories[category]) {
        alert(`No item purchased from ${category} category to undo.`);
        return;
    }

    const item = purchasedCategories[category];
    availableBudget += item.price;
    purchasedItems = purchasedItems.filter(i => i.category !== category);
    delete purchasedCategories[category];

    updateAvailableBudget();
    alert(`Undo purchase of ${item.name}. Budget refunded.`);

    // Update shop status
    const shopId = Object.keys(shopData).find(shopId => shopData[shopId].categories.includes(category));
    if (shopId) updateShopStatus(shopId);

    // Update Finish Button
    updateFinishTaskButton();
}



function enableBuyButton(category) {
    const buttons = document.querySelectorAll(`[data-category="${category}"]`);
    buttons.forEach(button => {
        button.disabled = false;
        button.innerText = 'Buy';
    });
}

function updatePurchasedItemsList() {
    const list = document.getElementById('purchasedItemsList');
    list.innerHTML = purchasedItems.length
        ? purchasedItems.map(item =>
            `<li>${item.name} - $${item.price}
                <button onclick="undoPurchase('${item.category}')">Undo</button>
            </li>`).join('')
        : '<p>No items purchased yet.</p>';
}

function showPurchasedItems() {
    updatePurchasedItemsList();
    const modal = new bootstrap.Modal(document.getElementById('purchasedItemsModal'));
    modal.show();
}
function updateAvailableBudget() {
    document.querySelectorAll('.availableBudget').forEach(el => {
        el.innerText = Math.ceil(availableBudget); // Round up to the nearest integer
    });
}


function goBackShop() {
    document.getElementById('itemSection').style.display = 'none';
    document.getElementById('shopSection').style.display = 'block';
}

function renderChart(category) {
    const chartsContainer = document.getElementById('chartsContainer');
    if (!chartsContainer) return;

    // Clear any previous chart
    chartsContainer.innerHTML = '';

    // Create a new canvas element for the chart
    const canvas = document.createElement('canvas');
    canvas.id = `chart-${category}`;
    chartsContainer.appendChild(canvas);

    const ctx = canvas.getContext('2d');
    const survey = surveyData[category]; // Get survey data for the category

    if (!survey) {
        console.error(`No data available for category: ${category}`);
        return;
    }

    // Render the chart
    new Chart(ctx, {
        type: 'bar', // Change chart type if needed
        data: {
            labels: ['Option 1', 'Option 2', 'Option 3', 'Option 4'], // Example labels
            datasets: [{
                label: `${survey.pollType} - ${category}`,
                data: survey.data,
                backgroundColor: [
                    'rgba(75, 192, 192, 0.6)',
                    'rgba(54, 162, 235, 0.6)',
                    'rgba(255, 206, 86, 0.6)',
                    'rgba(153, 102, 255, 0.6)'
                ],
                borderColor: [
                    'rgba(75, 192, 192, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(153, 102, 255, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false,
                    position: 'top',
                }
            }
        }
    });
}



function onCategoryClick(categoryId) {
    const category = categoryMapping[categoryId];
    if (!category) {
        console.error(`No mapping found for categoryId: ${categoryId}`);
        return;
    }
    renderChart(category); // Draw the chart for the selected category
}


document.addEventListener("DOMContentLoaded", function () {
    const tabs = document.querySelectorAll(".nav-link");

    tabs.forEach((tab) => {
        tab.addEventListener("click", function () {
            const categoryId = this.getAttribute("aria-controls"); // Get the category ID from the 'aria-controls' attribute
            onCategoryClick(categoryId);
        });
    });
});





function finishTask() {
    const allCategories = Object.keys(purchasedCategories);
    const totalCategories = 16;

    if (allCategories.length === totalCategories) {
        const resultData = { purchasedItems: purchasedItems, remainingBudget: availableBudget };

        fetch("/submit_task1_result", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(resultData),
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === "success") {
                alert('Congratulations! You have completed the task successfully. Redirecting to the next step.');
                window.location.href = data.redirect_url;
            } else {
                alert("Error saving task result. Please try again.");
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("Failed to submit task result.");
        });
    } else {
        const remaining = totalCategories - allCategories.length;
        alert(`You need to purchase ${remaining} more item(s) to finish the task.`);
    }
}

function loadDescription(shopName, description) {
    document.getElementById('shopName').innerText = shopName;
    document.getElementById('shopDescription').innerText = description;
}
document.addEventListener("DOMContentLoaded", function () {
    const tabs = document.querySelectorAll(".nav-link");

    tabs.forEach((tab) => {
        tab.addEventListener("click", function () {
            const category = this.getAttribute("aria-controls"); // Get the category ID from the 'aria-controls' attribute
            onCategoryClick(category);
        });
    });
});
    </script>
<script>
const canvas = document.getElementById('roomCanvas');
const ctx = canvas.getContext('2d');
const itemsInRoom = []; // Stores items placed in the room

let defaultPositionX = 50; // Initial position X for the first item
let defaultPositionY = 50; // Initial position Y for the first item
let selectedItem = null; // Item being dragged
let offsetX = 0; // X offset of the mouse from the item's origin
let offsetY = 0; // Y offset of the mouse from the item's origin

const MAX_ITEM_WIDTH = 100; // Maximum item width
const MAX_ITEM_HEIGHT = 100; // Maximum item height

// Preloaded images cache
const imageCache = {};

// Background image for the room
const backgroundImage = new Image();
backgroundImage.src = "../static/img/room-background.jpg"; // Replace with your image path

// Function to preload images
function preloadImage(src) {
    if (!imageCache[src]) {
        const img = new Image();
        img.src = src;
        imageCache[src] = img;
    }
    return imageCache[src];
}
function drawRoom() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw the background image
    if (backgroundImage.complete) {
        ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
    }

    // Draw each item
    itemsInRoom.forEach(item => {
        const img = preloadImage(item.image);
        if (img.complete) {
            ctx.drawImage(img, item.x, item.y, MAX_ITEM_WIDTH, MAX_ITEM_HEIGHT);

            // Draw the price tag at the middle of the image
            const text = `$${item.price}`;
            const textWidth = ctx.measureText(text).width;
            const tagX = item.x + (MAX_ITEM_WIDTH / 2) - (textWidth / 2); // Center horizontally
            const tagY = item.y + (MAX_ITEM_HEIGHT / 2) + 10; // Center vertically, adjust with padding

            // Draw background for price tag
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(tagX - 5, tagY - 15, textWidth + 10, 20);

            // Draw price tag text
            ctx.fillStyle = 'white';
            ctx.fillText(text, tagX, tagY);
        } else {
            img.onload = () => drawRoom(); // Redraw after image loads
        }
    });
}



// Place the item in the room (create DOM elements for the item and price tag)
function placeItemInRoom(item) {
    if (itemsInRoom.length >= (canvas.width / MAX_ITEM_WIDTH) * (canvas.height / MAX_ITEM_HEIGHT)) {
        alert("Room is full!"); // Notify if the room is full
        return;
    }

    // Add the item to the itemsInRoom array
    itemsInRoom.push({
        ...item,
        x: defaultPositionX,
        y: defaultPositionY
    });

    // Create the item element in the DOM
    const itemElement = document.createElement('div');
    itemElement.classList.add('item');
    itemElement.style.position = 'absolute';
    itemElement.style.left = `${defaultPositionX}px`;
    itemElement.style.top = `${defaultPositionY}px`;
    itemElement.innerHTML = item.name;

    // Append the item element to the room container
    const roomContainer = document.getElementById('room-container');
    roomContainer.appendChild(itemElement);

    // Store the DOM element for later access during dragging
    item.element = itemElement;

    // Update the position for the next item
    defaultPositionX += 120; // Adjust space between items
    if (defaultPositionX > canvas.width - 150) { // Check if item goes beyond canvas width
        defaultPositionX = 50; // Reset X position for next row
        defaultPositionY += 120; // Move to the next row
    }

    drawRoom(); // Redraw the room (canvas-based items only)
}


// Mouse events to handle dragging and moving the item and its price tag
canvas.addEventListener('mousedown', (event) => {
    const mouseX = event.offsetX;
    const mouseY = event.offsetY;

    // Check if an item is clicked
    selectedItem = itemsInRoom.find(item =>
        mouseX >= item.x &&
        mouseX <= item.x + MAX_ITEM_WIDTH &&
        mouseY >= item.y &&
        mouseY <= item.y + MAX_ITEM_HEIGHT
    );

    if (selectedItem) {
        offsetX = mouseX - selectedItem.x;
        offsetY = mouseY - selectedItem.y;
    }
});

canvas.addEventListener('mousemove', (event) => {
    if (selectedItem) {
        const mouseX = event.offsetX;
        const mouseY = event.offsetY;

        // Ensure item stays within canvas boundaries
        selectedItem.x = Math.min(Math.max(mouseX - offsetX, 0), canvas.width - MAX_ITEM_WIDTH);
        selectedItem.y = Math.min(Math.max(mouseY - offsetY, 0), canvas.height - MAX_ITEM_HEIGHT);

        // Move the item element in the DOM
        if (selectedItem.element) {
            selectedItem.element.style.left = `${selectedItem.x}px`;
            selectedItem.element.style.top = `${selectedItem.y}px`;
        }

        // Move the price tag element in the DOM to follow the item
        if (selectedItem.priceTag) {
            selectedItem.priceTag.style.left = `${selectedItem.x + 5}px`; // Slight offset from the item
            selectedItem.priceTag.style.top = `${selectedItem.y + 80}px`; // Slight offset from the item
        }

        drawRoom(); // Redraw the room (canvas-based items only)
    }
});

canvas.addEventListener('mouseup', () => {
    selectedItem = null; // Stop dragging
});


// Add a Back button to the top-left corner of the room
const roomContainer = document.getElementById('room-container');
const backButton = document.createElement('button');
backButton.innerText = "Back";
backButton.classList.add('btn', 'btn-primary');
backButton.style.position = 'absolute';
backButton.style.top = '10px';
backButton.style.left = '10px';
backButton.style.zIndex = '10'; // Ensure it stays on top of the canvas
backButton.onclick = goBack;
roomContainer.appendChild(backButton);

document.addEventListener("DOMContentLoaded", function () {
    updateFinishTaskButton();
});
function showProductDetail(item, category) {
    // Populate modal content
    document.getElementById('productDetailImage').src = item.image;
    document.getElementById('productDetailName').innerText = item.name;
    document.getElementById('productDetailPrice').innerText = `Price: $${item.price}`;
    document.getElementById('productDetailDescription').innerText = item.description;

    // Set the Buy button in the modal
    const buyButtonModal = document.querySelector('#productDetailModal .btn-buy-modal');
    buyButtonModal.onclick = () => {
        buyItem(item, category, null); // Pass null since this button is not directly linked to a card

        // Close the modal after purchase
        const modalElement = document.getElementById('productDetailModal');
        const modalInstance = bootstrap.Modal.getInstance(modalElement);
        modalInstance.hide();
    };

    // Show the modal
    const modal = new bootstrap.Modal(document.getElementById('productDetailModal'));
    modal.show();
}

</script>

{% endblock %}
